<!DOCTYPE html>
<html dir='ltr' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
<head>
<meta content='width=device-width, initial-scale=1' name='viewport'/>
<title>Next generation tools for data science</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<!-- Chrome, Firefox OS and Opera -->
<meta content='#eaeaea' name='theme-color'/>
<!-- Windows Phone -->
<meta content='#eaeaea' name='msapplication-navbutton-color'/>
<meta content='blogger' name='generator'/>
<link href='http://www.unofficialgoogledatascience.com/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="The Unofficial Google Data Science Blog - Atom" href="http://www.unofficialgoogledatascience.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="The Unofficial Google Data Science Blog - RSS" href="http://www.unofficialgoogledatascience.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="The Unofficial Google Data Science Blog - Atom" href="https://www.blogger.com/feeds/5825758052688213474/posts/default" />

<link rel="alternate" type="application/atom+xml" title="The Unofficial Google Data Science Blog - Atom" href="http://www.unofficialgoogledatascience.com/feeds/5882522097717497514/comments/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<link href='https://lh4.googleusercontent.com/OlvW6SskdqiFWmJeucVj-ESXH7c_GR_0af4Rdo0vDi78eVKVbusCTlbs7UouymD-cfxszDarNsIUexlyuInZ15Wgm6hTGpPVzo7spMvv1mNsf95qlxP5kEKjGMBtPfeyUB-E1qYU' rel='image_src'/>
<meta content='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' property='og:url'/>
<meta content='Next generation tools for data science' property='og:title'/>
<meta content='By DAVID ADAMS   Since inception, this blog has defined “data science”  as inference derived from data too big to fit on a single computer. ...' property='og:description'/>
<meta content='https://lh4.googleusercontent.com/OlvW6SskdqiFWmJeucVj-ESXH7c_GR_0af4Rdo0vDi78eVKVbusCTlbs7UouymD-cfxszDarNsIUexlyuInZ15Wgm6hTGpPVzo7spMvv1mNsf95qlxP5kEKjGMBtPfeyUB-E1qYU=w1200-h630-p-k-no-nu' property='og:image'/>
<!--[if IE]> <script> (function() { var html5 = ("abbr,article,aside,audio,canvas,datalist,details," + "figure,footer,header,hgroup,mark,menu,meter,nav,output," + "progress,section,time,video").split(','); for (var i = 0; i < html5.length; i++) { document.createElement(html5[i]); } try { document.execCommand('BackgroundImageCache', false, true); } catch(e) {} })(); </script> <![endif]-->
<style type='text/css'>@font-face{font-family:'Roboto';font-style:italic;font-weight:300;src:local('Roboto Light Italic'),local('Roboto-LightItalic'),url(//fonts.gstatic.com/s/roboto/v19/KFOjCnqEu92Fr1Mu51TjASc6CsE.ttf)format('truetype');}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;src:local('Roboto'),local('Roboto-Regular'),url(//fonts.gstatic.com/s/roboto/v19/KFOmCnqEu92Fr1Mu4mxP.ttf)format('truetype');}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;src:local('Roboto Bold'),local('Roboto-Bold'),url(//fonts.gstatic.com/s/roboto/v19/KFOlCnqEu92Fr1MmWUlfBBc9.ttf)format('truetype');}</style>
<style id='page-skin-1' type='text/css'><!--
/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}
/* 
<!-- Constants -->

<Variable name="damionRegular36" description="Damion Regular 36" type="font" default="400 36px Damion, cursive" hideEditor="true" />
<Variable name="damionRegular62" description="Damion Regular 62" type="font" default="400 62px Damion, cursive" hideEditor="true" />
<Variable name="playfairDisplayBlack28" description="Playfair Display Black 28" type="font" default="900 28px Playfair Display, serif" hideEditor="true" />
<Variable name="playfairDisplayBlack36" description="Playfair Display Black 36" type="font" default="900 36px Playfair Display, serif" hideEditor="true" />
<Variable name="playfairDisplayBlack44" description="Playfair Display Black 44" type="font" default="900 44px Playfair Display, serif" hideEditor="true" />
<Variable name="robotoNormal15" description="Roboto Normal 15" type="font" default="15px Roboto, sans-serif" hideEditor="true" />
<Variable name="robotoNormal16" description="Roboto Normal 16" type="font" default="16px Roboto, sans-serif" hideEditor="true" />
<Variable name="robotoLightItalic15" description="Roboto Light Italic 15" type="font" default="italic 300 15px Roboto, sans-serif" hideEditor="true" />
<Variable name="robotoBold22" description="Roboto Bold 22" type="font" default="bold 22px Roboto, sans-serif" hideEditor="true" />
<Variable name="robotoBold30" description="Roboto Bold 30" type="font" default="bold 30px Roboto, sans-serif" hideEditor="true" />
<Variable name="robotoBold45" description="Roboto Bold 45" type="font" default="bold 45px Roboto, sans-serif" hideEditor="true" />

<!-- Variable definitions -->

<Variable name="keycolor" description="Main Color" type="color" default="#2196f3" />
<Variable name="startSide" description="Start side in blog language" type="automatic" default="left" hideEditor="true" />
<Variable name="endSide" description="End side in blog language" type="automatic" default="right" hideEditor="true" />

<Group description="Page Text">
  <Variable name="body.text.font" description="Font"
      type="font"
      default="15px Roboto, sans-serif" />
  <Variable name="body.text.color" description="Color"
      type="color"
      default="#757575" />
</Group>

<Group description="Backgrounds">
  <Variable name="body.background.height" description="Background height"
      type="length"
      min="420px"
      max="640px"
      default="480px" />
  <Variable name="body.background" description="Background"
      color="#eaeaea"
      type="background"
      default="$(color) none repeat scroll top left" />
  <Variable name="body.background.color" description="Body background color"
      type="color"
      default="#eee" />
  <Variable name="posts.background.color" description="Post background color"
      type="color"
      default="#fff" />
  <Variable name="body.background.blur" description="Background blur"
      type="length"
      min="0px"
      max="50px"
      default="0px" />
</Group>

<Group description="Links">
  <Variable name="body.link.color" description="Link color"
      type="color"
      default="#2196f3" />
  <Variable name="body.link.visited.color" description="Visited link color"
      type="color"
      default="#3c79a7" />
  <Variable name="body.link.hover.color" description="Link Hover Color"
      type="color"
      default="#3c79a7" />
</Group>

<Group description="Blog title" selector="div.widget.Header">
  <Variable name="blog.title.font" description="Font"
      type="font"
      default="bold 45px Roboto, sans-serif" />
  <Variable name="blog.title.color" description="Color"
      type="color"
      default="#fff" />
  <Variable name="header.icons.color"
      description="Background icons color"
      type="color"
      default="#fff" />
</Group>

<Group description="Tabs text" selector="div.widget.PageList">
  <Variable name="tabs.font" description="Font"
      type="font"
      family="Roboto, sans-serif"
      size="15px"
      default="700 normal $(size) $(family)" />
  <Variable name="tabs.color" description="Text color"
      type="color"
      default="#ccc" />
  <Variable name="tabs.selected.color" description="Selected color"
      type="color"
      default="#fff" />
  <Variable name="tabs.overflow.background.color" description="Popup background color"
      type="color"
      default="#ffffff" />
  <Variable name="tabs.overflow.color" description="Popup text color"
      type="color"
      default="#4e4e4e" />
  <Variable name="tabs.overflow.selected.color" description="Popup selected color"
      type="color"
      default="#3b3b3b" />
</Group>

<Group description="Posts" selector="div.widget.Blog">
  <Variable name="posts.title.color" description="Post title color"
      type="color"
      default="#212121" />
  <Variable name="posts.title.font" description="Post title font"
      type="font"
      default="bold 22px Roboto, sans-serif" />
  <Variable name="posts.stream.title.font" description="Post title stream font"
      type="font"
      default="bold 30px Roboto, sans-serif" />
  <Variable name="posts.text.font" description="Post text font"
      type="font"
      default="15px Roboto, sans-serif" />
  <Variable name="posts.text.color" description="Post text color"
      type="color"
      default="#666666" />
  <Variable name="posts.byline.color" description="Post byline color"
      type="color"
      default="rgba(0, 0, 0, 0.54)" />
  <Variable name="blockquote.font" description="Blockquote font"
      type="font"
      default="italic 300 15px Roboto, sans-serif" />
  <Variable name="blockquote.color" description="Blockquote color"
      type="color"
      default="#444" />
  <Variable name="posts.icons.color"
      description="Post icons color"
      type="color"
      default="#707070" />
</Group>

<Group description="Search">
  <Variable name="search.input.color" description="Input color"
      type="color"
      default="#ffffff" />
  <Variable name="search.input.font" description="Input font"
      type="font"
      default="16px Roboto, sans-serif" />
  <Variable name="search.placeholder.color" description="Placeholder text color"
      type="color"
      default="#ffffff" />
</Group>

<Group description="Sharing">
  <Variable name="sharing.background.color"
      description="Sharing background color"
      type="color"
      default="#ffffff" />
  <Variable name="sharing.text.color" description="Sharing text color"
      type="color"
      default="#3b3b3b" />
  <Variable name="sharing.icons.color"
      description="Sharing icons color"
      type="color"
      default="#212121" />
</Group>

<Group description="Popular posts" selector="div.widget.PopularPosts">
  <Variable name="popularposts.background.color"
      description="Popular post background color"
      type="color"
      default="#eaeaea" />
  <Variable name="popularposts.byline.color"
      description="Popular post byline color"
      type="color"
      default="rgba(0, 0, 0, 0.54)" />
  <Variable name="popularposts.title.color"
      description="Popular post title color"
      type="color"
      default="#3b3b3b" />
  <Variable name="popularposts.text.color"
      description="Popular post text color"
      type="color"
      default="#4e4e4e" />
  <Variable name="popularposts.link.color"
      description="Popular post link color"
      type="color"
      default="#3c79a7" />
</Group>

<Group description="Post navigation" selector='div.blog-pager'>
  <Variable name="posts.navigation.link.color"
      description="Post navigation links color"
      type="color"
      default="#3c79a7" />
  <Variable name="posts.navigation.link.visited.color"
      description="Post navigation links visited color"
      type="color"
      default="#3c79a7" />
  <Variable name="posts.navigation.link.hover.color"
      description="Post navigations links hover color"
      type="color"
      default="#2196f3" />
</Group>

<Group description="Sidebar" selector="div.sidebar-container">
  <Variable name="sidebar.backgroundColorTop"
      description="Background color (Top)"
      type="color"
      default="#f7f7f7" />
  <Variable name="sidebar.backgroundColorTopHD"
      description="Background color (Top) - HD"
      type="color"
      default="rgba(255, 255, 255, 1)" />
  <Variable name="sidebar.backgroundColorBottom"
      description="Background color (Bottom)"
      type="color"
      default="#fff" />
  <Variable name="sidebar.separator.color"
      description="Separator color"
      type="color"
      default="#ccc" />
  <Variable name="widget.title.color"
      description="Gadget title color"
      type="color"
      default="#212121" />
  <Variable name="sidebar.icons.color"
      description="Sidebar icons color"
      type="color"
      default="#707070" />
</Group>

<Group description="Author profile" selector='.widget.Profile'>
  <Variable name="profile.title.color" description="Profile title color"
      type="color"
      default="rgba(0,0,0,0.52)" />
  <Variable name="profile.text.color" description="Profile text color"
      type="color"
      default="rgba(0, 0, 0, 0.54)" />
  <Variable name="profile.link.color" description="Profile link color"
      type="color"
      default="#3b3b3b" />
</Group>

<Group description="Labels" selector=".widget.Label">
  <Variable name="labels.text.color"
      description="Label text color"
      type="color"
      default="#3c79a7" />
  <Variable name="labels.background.color"
      description="Label background color"
      type="color"
      red="0"
      green="0"
      blue="0"
      default="rgba($red, $green, $blue, 0.05)" />
</Group>

<Group description="Attribution" selector=".widget.Attribution">
  <Variable name="attribution.text.color" description="Attribution text color"
      type="color"
      default="#666666" />
  <Variable name="attribution.link.color" description="Attribution link color"
      type="color"
      default="#3c79a7" />
  <Variable name="attribution.icon.color" description="Attribution icon color"
      type="color"
      default="#707070"
      hideEditor="true" />
</Group>

<Group description="Widths">
  <Variable name="sidebar.width" description="Sidebar width" type="length"
            min="100px" max="1000px" default="284px" />
  <Variable name="content.width" description="Content width" type="length"
            min="600px" max="2400px" default="922px" />
  <Variable name="content.margin" description="Content margin" type="length"
            min="0px" max="1000px" default="117px" />
</Group>
 */

/*!************************************************
 * Blogger Template Style
 * Name: Contempo
 **************************************************/
body{
overflow-wrap:break-word;
word-break:break-word;
word-wrap:break-word
}
.hidden{
display:none
}
.invisible{
visibility:hidden
}
.container::after,.float-container::after{
clear:both;
content:"";
display:table
}
.clearboth{
clear:both
}
#comments .comment .comment-actions,.subscribe-popup .FollowByEmail .follow-by-email-submit,.widget.Profile .profile-link,.widget.Profile .profile-link.visit-profile{
background:0 0;
border:0;
box-shadow:none;
color:#3c79a7;
cursor:pointer;
font-size:14px;
font-weight:700;
outline:0;
text-decoration:none;
text-transform:uppercase;
width:auto
}
.dim-overlay{
background-color:rgba(0,0,0,.54);
height:100vh;
left:0;
position:fixed;
top:0;
width:100%
}
#sharing-dim-overlay{
background-color:transparent
}
input::-ms-clear{
display:none
}
.blogger-logo,.svg-icon-24.blogger-logo{
fill:#ff9800;
opacity:1
}
.loading-spinner-large{
-webkit-animation:mspin-rotate 1.568s infinite linear;
animation:mspin-rotate 1.568s infinite linear;
height:48px;
overflow:hidden;
position:absolute;
width:48px;
z-index:200
}
.loading-spinner-large>div{
-webkit-animation:mspin-revrot 5332ms infinite steps(4);
animation:mspin-revrot 5332ms infinite steps(4)
}
.loading-spinner-large>div>div{
-webkit-animation:mspin-singlecolor-large-film 1333ms infinite steps(81);
animation:mspin-singlecolor-large-film 1333ms infinite steps(81);
background-size:100%;
height:48px;
width:3888px
}
.mspin-black-large>div>div,.mspin-grey_54-large>div>div{
background-image:url(https://www.blogblog.com/indie/mspin_black_large.svg)
}
.mspin-white-large>div>div{
background-image:url(https://www.blogblog.com/indie/mspin_white_large.svg)
}
.mspin-grey_54-large{
opacity:.54
}
@-webkit-keyframes mspin-singlecolor-large-film{
from{
-webkit-transform:translateX(0);
transform:translateX(0)
}
to{
-webkit-transform:translateX(-3888px);
transform:translateX(-3888px)
}
}
@keyframes mspin-singlecolor-large-film{
from{
-webkit-transform:translateX(0);
transform:translateX(0)
}
to{
-webkit-transform:translateX(-3888px);
transform:translateX(-3888px)
}
}
@-webkit-keyframes mspin-rotate{
from{
-webkit-transform:rotate(0);
transform:rotate(0)
}
to{
-webkit-transform:rotate(360deg);
transform:rotate(360deg)
}
}
@keyframes mspin-rotate{
from{
-webkit-transform:rotate(0);
transform:rotate(0)
}
to{
-webkit-transform:rotate(360deg);
transform:rotate(360deg)
}
}
@-webkit-keyframes mspin-revrot{
from{
-webkit-transform:rotate(0);
transform:rotate(0)
}
to{
-webkit-transform:rotate(-360deg);
transform:rotate(-360deg)
}
}
@keyframes mspin-revrot{
from{
-webkit-transform:rotate(0);
transform:rotate(0)
}
to{
-webkit-transform:rotate(-360deg);
transform:rotate(-360deg)
}
}
.skip-navigation{
background-color:#fff;
box-sizing:border-box;
color:#000;
display:block;
height:0;
left:0;
line-height:50px;
overflow:hidden;
padding-top:0;
position:fixed;
text-align:center;
top:0;
-webkit-transition:box-shadow .3s,height .3s,padding-top .3s;
transition:box-shadow .3s,height .3s,padding-top .3s;
width:100%;
z-index:900
}
.skip-navigation:focus{
box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2);
height:50px
}
#main{
outline:0
}
.main-heading{
position:absolute;
clip:rect(1px,1px,1px,1px);
padding:0;
border:0;
height:1px;
width:1px;
overflow:hidden
}
.Attribution{
margin-top:1em;
text-align:center
}
.Attribution .blogger img,.Attribution .blogger svg{
vertical-align:bottom
}
.Attribution .blogger img{
margin-right:.5em
}
.Attribution div{
line-height:24px;
margin-top:.5em
}
.Attribution .copyright,.Attribution .image-attribution{
font-size:.7em;
margin-top:1.5em
}
.BLOG_mobile_video_class{
display:none
}
.bg-photo{
background-attachment:scroll!important
}
body .CSS_LIGHTBOX{
z-index:900
}
.extendable .show-less,.extendable .show-more{
border-color:#3c79a7;
color:#3c79a7;
margin-top:8px
}
.extendable .show-less.hidden,.extendable .show-more.hidden{
display:none
}
.inline-ad{
display:none;
max-width:100%;
overflow:hidden
}
.adsbygoogle{
display:block
}
#cookieChoiceInfo{
bottom:0;
top:auto
}
iframe.b-hbp-video{
border:0
}
.post-body img{
max-width:100%
}
.post-body iframe{
max-width:100%
}
.post-body a[imageanchor="1"]{
display:inline-block
}
.byline{
margin-right:1em
}
.byline:last-child{
margin-right:0
}
.link-copied-dialog{
max-width:520px;
outline:0
}
.link-copied-dialog .modal-dialog-buttons{
margin-top:8px
}
.link-copied-dialog .goog-buttonset-default{
background:0 0;
border:0
}
.link-copied-dialog .goog-buttonset-default:focus{
outline:0
}
.paging-control-container{
margin-bottom:16px
}
.paging-control-container .paging-control{
display:inline-block
}
.paging-control-container .comment-range-text::after,.paging-control-container .paging-control{
color:#3c79a7
}
.paging-control-container .comment-range-text,.paging-control-container .paging-control{
margin-right:8px
}
.paging-control-container .comment-range-text::after,.paging-control-container .paging-control::after{
content:"\b7";
cursor:default;
padding-left:8px;
pointer-events:none
}
.paging-control-container .comment-range-text:last-child::after,.paging-control-container .paging-control:last-child::after{
content:none
}
.byline.reactions iframe{
height:20px
}
.b-notification{
color:#000;
background-color:#fff;
border-bottom:solid 1px #000;
box-sizing:border-box;
padding:16px 32px;
text-align:center
}
.b-notification.visible{
-webkit-transition:margin-top .3s cubic-bezier(.4,0,.2,1);
transition:margin-top .3s cubic-bezier(.4,0,.2,1)
}
.b-notification.invisible{
position:absolute
}
.b-notification-close{
position:absolute;
right:8px;
top:8px
}
.no-posts-message{
line-height:40px;
text-align:center
}
@media screen and (max-width:800px){
body.item-view .post-body a[imageanchor="1"][style*="float: left;"],body.item-view .post-body a[imageanchor="1"][style*="float: right;"]{
float:none!important;
clear:none!important
}
body.item-view .post-body a[imageanchor="1"] img{
display:block;
height:auto;
margin:0 auto
}
body.item-view .post-body>.separator:first-child>a[imageanchor="1"]:first-child{
margin-top:20px
}
.post-body a[imageanchor]{
display:block
}
body.item-view .post-body a[imageanchor="1"]{
margin-left:0!important;
margin-right:0!important
}
body.item-view .post-body a[imageanchor="1"]+a[imageanchor="1"]{
margin-top:16px
}
}
.item-control{
display:none
}
#comments{
border-top:1px dashed rgba(0,0,0,.54);
margin-top:20px;
padding:20px
}
#comments .comment-thread ol{
margin:0;
padding-left:0;
padding-left:0
}
#comments .comment .comment-replybox-single,#comments .comment-thread .comment-replies{
margin-left:60px
}
#comments .comment-thread .thread-count{
display:none
}
#comments .comment{
list-style-type:none;
padding:0 0 30px;
position:relative
}
#comments .comment .comment{
padding-bottom:8px
}
.comment .avatar-image-container{
position:absolute
}
.comment .avatar-image-container img{
border-radius:50%
}
.avatar-image-container svg,.comment .avatar-image-container .avatar-icon{
border-radius:50%;
border:solid 1px #5b5b5b;
box-sizing:border-box;
fill:#5b5b5b;
height:35px;
margin:0;
padding:7px;
width:35px
}
.comment .comment-block{
margin-top:10px;
margin-left:60px;
padding-bottom:0
}
#comments .comment-author-header-wrapper{
margin-left:40px
}
#comments .comment .thread-expanded .comment-block{
padding-bottom:20px
}
#comments .comment .comment-header .user,#comments .comment .comment-header .user a{
color:#3b3b3b;
font-style:normal;
font-weight:700
}
#comments .comment .comment-actions{
bottom:0;
margin-bottom:15px;
position:absolute
}
#comments .comment .comment-actions>*{
margin-right:8px
}
#comments .comment .comment-header .datetime{
bottom:0;
color:rgba(59,59,59,.54);
display:inline-block;
font-size:13px;
font-style:italic;
margin-left:8px
}
#comments .comment .comment-footer .comment-timestamp a,#comments .comment .comment-header .datetime a{
color:rgba(59,59,59,.54)
}
#comments .comment .comment-content,.comment .comment-body{
margin-top:12px;
word-break:break-word
}
.comment-body{
margin-bottom:12px
}
#comments.embed[data-num-comments="0"]{
border:0;
margin-top:0;
padding-top:0
}
#comments.embed[data-num-comments="0"] #comment-post-message,#comments.embed[data-num-comments="0"] div.comment-form>p,#comments.embed[data-num-comments="0"] p.comment-footer{
display:none
}
#comment-editor-src{
display:none
}
.comments .comments-content .loadmore.loaded{
max-height:0;
opacity:0;
overflow:hidden
}
.extendable .remaining-items{
height:0;
overflow:hidden;
-webkit-transition:height .3s cubic-bezier(.4,0,.2,1);
transition:height .3s cubic-bezier(.4,0,.2,1)
}
.extendable .remaining-items.expanded{
height:auto
}
.svg-icon-24,.svg-icon-24-button{
cursor:pointer;
height:24px;
width:24px;
min-width:24px
}
.touch-icon{
margin:-12px;
padding:12px
}
.touch-icon:active,.touch-icon:focus{
background-color:rgba(153,153,153,.4);
border-radius:50%
}
svg:not(:root).touch-icon{
overflow:visible
}
html[dir=rtl] .rtl-reversible-icon{
-webkit-transform:scaleX(-1);
-ms-transform:scaleX(-1);
transform:scaleX(-1)
}
.svg-icon-24-button,.touch-icon-button{
background:0 0;
border:0;
margin:0;
outline:0;
padding:0
}
.touch-icon-button .touch-icon:active,.touch-icon-button .touch-icon:focus{
background-color:transparent
}
.touch-icon-button:active .touch-icon,.touch-icon-button:focus .touch-icon{
background-color:rgba(153,153,153,.4);
border-radius:50%
}
.Profile .default-avatar-wrapper .avatar-icon{
border-radius:50%;
border:solid 1px #5b5b5b;
box-sizing:border-box;
fill:#5b5b5b;
margin:0
}
.Profile .individual .default-avatar-wrapper .avatar-icon{
padding:25px
}
.Profile .individual .avatar-icon,.Profile .individual .profile-img{
height:120px;
width:120px
}
.Profile .team .default-avatar-wrapper .avatar-icon{
padding:8px
}
.Profile .team .avatar-icon,.Profile .team .default-avatar-wrapper,.Profile .team .profile-img{
height:40px;
width:40px
}
.snippet-container{
margin:0;
position:relative;
overflow:hidden
}
.snippet-fade{
bottom:0;
box-sizing:border-box;
position:absolute;
width:96px
}
.snippet-fade{
right:0
}
.snippet-fade:after{
content:"\2026"
}
.snippet-fade:after{
float:right
}
.post-bottom{
-webkit-box-align:center;
-webkit-align-items:center;
-ms-flex-align:center;
align-items:center;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-wrap:wrap;
-ms-flex-wrap:wrap;
flex-wrap:wrap
}
.post-footer{
-webkit-box-flex:1;
-webkit-flex:1 1 auto;
-ms-flex:1 1 auto;
flex:1 1 auto;
-webkit-flex-wrap:wrap;
-ms-flex-wrap:wrap;
flex-wrap:wrap;
-webkit-box-ordinal-group:2;
-webkit-order:1;
-ms-flex-order:1;
order:1
}
.post-footer>*{
-webkit-box-flex:0;
-webkit-flex:0 1 auto;
-ms-flex:0 1 auto;
flex:0 1 auto
}
.post-footer .byline:last-child{
margin-right:1em
}
.jump-link{
-webkit-box-flex:0;
-webkit-flex:0 0 auto;
-ms-flex:0 0 auto;
flex:0 0 auto;
-webkit-box-ordinal-group:3;
-webkit-order:2;
-ms-flex-order:2;
order:2
}
.centered-top-container.sticky{
left:0;
position:fixed;
right:0;
top:0;
width:auto;
z-index:50;
-webkit-transition-property:opacity,-webkit-transform;
transition-property:opacity,-webkit-transform;
transition-property:transform,opacity;
transition-property:transform,opacity,-webkit-transform;
-webkit-transition-duration:.2s;
transition-duration:.2s;
-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);
transition-timing-function:cubic-bezier(.4,0,.2,1)
}
.centered-top-placeholder{
display:none
}
.collapsed-header .centered-top-placeholder{
display:block
}
.centered-top-container .Header .replaced h1,.centered-top-placeholder .Header .replaced h1{
display:none
}
.centered-top-container.sticky .Header .replaced h1{
display:block
}
.centered-top-container.sticky .Header .header-widget{
background:0 0
}
.centered-top-container.sticky .Header .header-image-wrapper{
display:none
}
.centered-top-container img,.centered-top-placeholder img{
max-width:100%
}
.collapsible{
-webkit-transition:height .3s cubic-bezier(.4,0,.2,1);
transition:height .3s cubic-bezier(.4,0,.2,1)
}
.collapsible,.collapsible>summary{
display:block;
overflow:hidden
}
.collapsible>:not(summary){
display:none
}
.collapsible[open]>:not(summary){
display:block
}
.collapsible:focus,.collapsible>summary:focus{
outline:0
}
.collapsible>summary{
cursor:pointer;
display:block;
padding:0
}
.collapsible:focus>summary,.collapsible>summary:focus{
background-color:transparent
}
.collapsible>summary::-webkit-details-marker{
display:none
}
.collapsible-title{
-webkit-box-align:center;
-webkit-align-items:center;
-ms-flex-align:center;
align-items:center;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex
}
.collapsible-title .title{
-webkit-box-flex:1;
-webkit-flex:1 1 auto;
-ms-flex:1 1 auto;
flex:1 1 auto;
-webkit-box-ordinal-group:1;
-webkit-order:0;
-ms-flex-order:0;
order:0;
overflow:hidden;
text-overflow:ellipsis;
white-space:nowrap
}
.collapsible-title .chevron-down,.collapsible[open] .collapsible-title .chevron-up{
display:block
}
.collapsible-title .chevron-up,.collapsible[open] .collapsible-title .chevron-down{
display:none
}
.flat-button{
cursor:pointer;
display:inline-block;
font-weight:700;
text-transform:uppercase;
border-radius:2px;
padding:8px;
margin:-8px
}
.flat-icon-button{
background:0 0;
border:0;
margin:0;
outline:0;
padding:0;
margin:-12px;
padding:12px;
cursor:pointer;
box-sizing:content-box;
display:inline-block;
line-height:0
}
.flat-icon-button,.flat-icon-button .splash-wrapper{
border-radius:50%
}
.flat-icon-button .splash.animate{
-webkit-animation-duration:.3s;
animation-duration:.3s
}
.overflowable-container{
max-height:46px;
overflow:hidden;
position:relative
}
.overflow-button{
cursor:pointer
}
#overflowable-dim-overlay{
background:0 0
}
.overflow-popup{
box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);
background-color:#ffffff;
left:0;
max-width:calc(100% - 32px);
position:absolute;
top:0;
visibility:hidden;
z-index:101
}
.overflow-popup ul{
list-style:none
}
.overflow-popup .tabs li,.overflow-popup li{
display:block;
height:auto
}
.overflow-popup .tabs li{
padding-left:0;
padding-right:0
}
.overflow-button.hidden,.overflow-popup .tabs li.hidden,.overflow-popup li.hidden{
display:none
}
.pill-button{
background:0 0;
border:1px solid;
border-radius:12px;
cursor:pointer;
display:inline-block;
padding:4px 16px;
text-transform:uppercase
}
.ripple{
position:relative
}
.ripple>*{
z-index:1
}
.splash-wrapper{
bottom:0;
left:0;
overflow:hidden;
pointer-events:none;
position:absolute;
right:0;
top:0;
z-index:0
}
.splash{
background:#ccc;
border-radius:100%;
display:block;
opacity:.6;
position:absolute;
-webkit-transform:scale(0);
-ms-transform:scale(0);
transform:scale(0)
}
.splash.animate{
-webkit-animation:ripple-effect .4s linear;
animation:ripple-effect .4s linear
}
@-webkit-keyframes ripple-effect{
100%{
opacity:0;
-webkit-transform:scale(2.5);
transform:scale(2.5)
}
}
@keyframes ripple-effect{
100%{
opacity:0;
-webkit-transform:scale(2.5);
transform:scale(2.5)
}
}
.search{
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
line-height:24px;
width:24px
}
.search.focused{
width:100%
}
.search.focused .section{
width:100%
}
.search form{
z-index:101
}
.search h3{
display:none
}
.search form{
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-box-flex:1;
-webkit-flex:1 0 0;
-ms-flex:1 0 0px;
flex:1 0 0;
border-bottom:solid 1px transparent;
padding-bottom:8px
}
.search form>*{
display:none
}
.search.focused form>*{
display:block
}
.search .search-input label{
display:none
}
.centered-top-placeholder.cloned .search form{
z-index:30
}
.search.focused form{
border-color:#ffffff;
position:relative;
width:auto
}
.collapsed-header .centered-top-container .search.focused form{
border-bottom-color:transparent
}
.search-expand{
-webkit-box-flex:0;
-webkit-flex:0 0 auto;
-ms-flex:0 0 auto;
flex:0 0 auto
}
.search-expand-text{
display:none
}
.search-close{
display:inline;
vertical-align:middle
}
.search-input{
-webkit-box-flex:1;
-webkit-flex:1 0 1px;
-ms-flex:1 0 1px;
flex:1 0 1px
}
.search-input input{
background:0 0;
border:0;
box-sizing:border-box;
color:#ffffff;
display:inline-block;
outline:0;
width:calc(100% - 48px)
}
.search-input input.no-cursor{
color:transparent;
text-shadow:0 0 0 #ffffff
}
.collapsed-header .centered-top-container .search-action,.collapsed-header .centered-top-container .search-input input{
color:#3b3b3b
}
.collapsed-header .centered-top-container .search-input input.no-cursor{
color:transparent;
text-shadow:0 0 0 #3b3b3b
}
.collapsed-header .centered-top-container .search-input input.no-cursor:focus,.search-input input.no-cursor:focus{
outline:0
}
.search-focused>*{
visibility:hidden
}
.search-focused .search,.search-focused .search-icon{
visibility:visible
}
.search.focused .search-action{
display:block
}
.search.focused .search-action:disabled{
opacity:.3
}
.widget.Sharing .sharing-button{
display:none
}
.widget.Sharing .sharing-buttons li{
padding:0
}
.widget.Sharing .sharing-buttons li span{
display:none
}
.post-share-buttons{
position:relative
}
.centered-bottom .share-buttons .svg-icon-24,.share-buttons .svg-icon-24{
fill:#212121
}
.sharing-open.touch-icon-button:active .touch-icon,.sharing-open.touch-icon-button:focus .touch-icon{
background-color:transparent
}
.share-buttons{
background-color:#ffffff;
border-radius:2px;
box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);
color:#212121;
list-style:none;
margin:0;
padding:8px 0;
position:absolute;
top:-11px;
min-width:200px;
z-index:101
}
.share-buttons.hidden{
display:none
}
.sharing-button{
background:0 0;
border:0;
margin:0;
outline:0;
padding:0;
cursor:pointer
}
.share-buttons li{
margin:0;
height:48px
}
.share-buttons li:last-child{
margin-bottom:0
}
.share-buttons li .sharing-platform-button{
box-sizing:border-box;
cursor:pointer;
display:block;
height:100%;
margin-bottom:0;
padding:0 16px;
position:relative;
width:100%
}
.share-buttons li .sharing-platform-button:focus,.share-buttons li .sharing-platform-button:hover{
background-color:rgba(128,128,128,.1);
outline:0
}
.share-buttons li svg[class*=" sharing-"],.share-buttons li svg[class^=sharing-]{
position:absolute;
top:10px
}
.share-buttons li span.sharing-platform-button{
position:relative;
top:0
}
.share-buttons li .platform-sharing-text{
display:block;
font-size:16px;
line-height:48px;
white-space:nowrap
}
.share-buttons li .platform-sharing-text{
margin-left:56px
}
.sidebar-container{
background-color:#ffffff;
max-width:284px;
overflow-y:auto;
-webkit-transition-property:-webkit-transform;
transition-property:-webkit-transform;
transition-property:transform;
transition-property:transform,-webkit-transform;
-webkit-transition-duration:.3s;
transition-duration:.3s;
-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);
transition-timing-function:cubic-bezier(0,0,.2,1);
width:284px;
z-index:101;
-webkit-overflow-scrolling:touch
}
.sidebar-container .navigation{
line-height:0;
padding:16px
}
.sidebar-container .sidebar-back{
cursor:pointer
}
.sidebar-container .widget{
background:0 0;
margin:0 16px;
padding:16px 0
}
.sidebar-container .widget .title{
color:#000000;
margin:0
}
.sidebar-container .widget ul{
list-style:none;
margin:0;
padding:0
}
.sidebar-container .widget ul ul{
margin-left:1em
}
.sidebar-container .widget li{
font-size:16px;
line-height:normal
}
.sidebar-container .widget+.widget{
border-top:1px dashed #c6c6c6
}
.BlogArchive li{
margin:16px 0
}
.BlogArchive li:last-child{
margin-bottom:0
}
.Label li a{
display:inline-block
}
.BlogArchive .post-count,.Label .label-count{
float:right;
margin-left:.25em
}
.BlogArchive .post-count::before,.Label .label-count::before{
content:"("
}
.BlogArchive .post-count::after,.Label .label-count::after{
content:")"
}
.widget.Translate .skiptranslate>div{
display:block!important
}
.widget.Profile .profile-link{
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex
}
.widget.Profile .team-member .default-avatar-wrapper,.widget.Profile .team-member .profile-img{
-webkit-box-flex:0;
-webkit-flex:0 0 auto;
-ms-flex:0 0 auto;
flex:0 0 auto;
margin-right:1em
}
.widget.Profile .individual .profile-link{
-webkit-box-orient:vertical;
-webkit-box-direction:normal;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column
}
.widget.Profile .team .profile-link .profile-name{
-webkit-align-self:center;
-ms-flex-item-align:center;
align-self:center;
display:block;
-webkit-box-flex:1;
-webkit-flex:1 1 auto;
-ms-flex:1 1 auto;
flex:1 1 auto
}
.dim-overlay{
background-color:rgba(0,0,0,.54);
z-index:100
}
body.sidebar-visible{
overflow-y:hidden
}
@media screen and (max-width:1439px){
.sidebar-container{
bottom:0;
position:fixed;
top:0;
left:0;
right:auto
}
.sidebar-container.sidebar-invisible{
-webkit-transition-timing-function:cubic-bezier(.4,0,.6,1);
transition-timing-function:cubic-bezier(.4,0,.6,1);
-webkit-transform:translateX(-284px);
-ms-transform:translateX(-284px);
transform:translateX(-284px)
}
}
@media screen and (min-width:1440px){
.sidebar-container{
position:absolute;
top:0;
left:0;
right:auto
}
.sidebar-container .navigation{
display:none
}
}
.dialog{
box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);
background:#ffffff;
box-sizing:border-box;
color:#666666;
padding:30px;
position:fixed;
text-align:center;
width:calc(100% - 24px);
z-index:101
}
.dialog input[type=email],.dialog input[type=text]{
background-color:transparent;
border:0;
border-bottom:solid 1px rgba(102,102,102,.12);
color:#666666;
display:block;
font-family:Roboto, sans-serif;
font-size:16px;
line-height:24px;
margin:auto;
padding-bottom:7px;
outline:0;
text-align:center;
width:100%
}
.dialog input[type=email]::-webkit-input-placeholder,.dialog input[type=text]::-webkit-input-placeholder{
color:#666666
}
.dialog input[type=email]::-moz-placeholder,.dialog input[type=text]::-moz-placeholder{
color:#666666
}
.dialog input[type=email]:-ms-input-placeholder,.dialog input[type=text]:-ms-input-placeholder{
color:#666666
}
.dialog input[type=email]::-ms-input-placeholder,.dialog input[type=text]::-ms-input-placeholder{
color:#666666
}
.dialog input[type=email]::placeholder,.dialog input[type=text]::placeholder{
color:#666666
}
.dialog input[type=email]:focus,.dialog input[type=text]:focus{
border-bottom:solid 2px #3c79a7;
padding-bottom:6px
}
.dialog input.no-cursor{
color:transparent;
text-shadow:0 0 0 #666666
}
.dialog input.no-cursor:focus{
outline:0
}
.dialog input.no-cursor:focus{
outline:0
}
.dialog input[type=submit]{
font-family:Roboto, sans-serif
}
.dialog .goog-buttonset-default{
color:#3c79a7
}
.subscribe-popup{
max-width:364px
}
.subscribe-popup h3{
color:#3b3b3b;
font-size:1.8em;
margin-top:0
}
.subscribe-popup .FollowByEmail h3{
display:none
}
.subscribe-popup .FollowByEmail .follow-by-email-submit{
color:#3c79a7;
display:inline-block;
margin:0 auto;
margin-top:24px;
width:auto;
white-space:normal
}
.subscribe-popup .FollowByEmail .follow-by-email-submit:disabled{
cursor:default;
opacity:.3
}
@media (max-width:800px){
.blog-name div.widget.Subscribe{
margin-bottom:16px
}
body.item-view .blog-name div.widget.Subscribe{
margin:8px auto 16px auto;
width:100%
}
}
.tabs{
list-style:none
}
.tabs li{
display:inline-block
}
.tabs li a{
cursor:pointer;
display:inline-block;
font-weight:700;
text-transform:uppercase;
padding:12px 8px
}
.tabs .selected{
border-bottom:4px solid #ffffff
}
.tabs .selected a{
color:#ffffff
}
body#layout .bg-photo,body#layout .bg-photo-overlay{
display:none
}
body#layout .page_body{
padding:0;
position:relative;
top:0
}
body#layout .page{
display:inline-block;
left:inherit;
position:relative;
vertical-align:top;
width:540px
}
body#layout .centered{
max-width:954px
}
body#layout .navigation{
display:none
}
body#layout .sidebar-container{
display:inline-block;
width:40%
}
body#layout .hamburger-menu,body#layout .search{
display:none
}
.centered-top-container .svg-icon-24,body.collapsed-header .centered-top-placeholder .svg-icon-24{
fill:#ffffff
}
.sidebar-container .svg-icon-24{
fill:#5b5b5b
}
.centered-bottom .svg-icon-24,body.collapsed-header .centered-top-container .svg-icon-24{
fill:#5b5b5b
}
.centered-bottom .share-buttons .svg-icon-24,.share-buttons .svg-icon-24{
fill:#212121
}
body{
background-color:#eaeaea;
color:#666666;
font:15px Roboto, sans-serif;
margin:0;
min-height:100vh
}
img{
max-width:100%
}
h3{
color:#666666;
font-size:16px
}
a{
text-decoration:none;
color:#3c79a7
}
a:visited{
color:#3c79a7
}
a:hover{
color:#2196f3
}
blockquote{
color:#000000;
font:italic 300 15px Roboto, sans-serif;
font-size:x-large;
text-align:center
}
.pill-button{
font-size:12px
}
.bg-photo-container{
height:470px;
overflow:hidden;
position:absolute;
width:100%;
z-index:1
}
.bg-photo{
background:#eaeaea url(http://2.bp.blogspot.com/-x4SlpiHfSJ8/Vyjtmvpt5kI/AAAAAAAADn4/7NTxE5yxeE8_M58uwT6AoZ3W6P9sxB6TwCK4B/s1600/newton_cropped.jpg) repeat fixed top left;
background-attachment:scroll;
background-size:cover;
-webkit-filter:blur(3px);
filter:blur(3px);
height:calc(100% + 2 * 3px);
left:-3px;
position:absolute;
top:-3px;
width:calc(100% + 2 * 3px)
}
.bg-photo-overlay{
background:rgba(0,0,0,.26);
background-size:cover;
height:470px;
position:absolute;
width:100%;
z-index:2
}
.hamburger-menu{
float:left;
margin-top:0
}
.sticky .hamburger-menu{
float:none;
position:absolute
}
.search{
border-bottom:solid 1px rgba(255, 255, 255, 0);
float:right;
position:relative;
-webkit-transition-property:width;
transition-property:width;
-webkit-transition-duration:.5s;
transition-duration:.5s;
-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);
transition-timing-function:cubic-bezier(.4,0,.2,1);
z-index:101
}
.search .dim-overlay{
background-color:transparent
}
.search form{
height:36px;
-webkit-transition-property:border-color;
transition-property:border-color;
-webkit-transition-delay:.5s;
transition-delay:.5s;
-webkit-transition-duration:.2s;
transition-duration:.2s;
-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);
transition-timing-function:cubic-bezier(.4,0,.2,1)
}
.search.focused{
width:calc(100% - 48px)
}
.search.focused form{
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-box-flex:1;
-webkit-flex:1 0 1px;
-ms-flex:1 0 1px;
flex:1 0 1px;
border-color:#ffffff;
margin-left:-24px;
padding-left:36px;
position:relative;
width:auto
}
.item-view .search,.sticky .search{
right:0;
float:none;
margin-left:0;
position:absolute
}
.item-view .search.focused,.sticky .search.focused{
width:calc(100% - 50px)
}
.item-view .search.focused form,.sticky .search.focused form{
border-bottom-color:#4e4e4e
}
.centered-top-placeholder.cloned .search form{
z-index:30
}
.search_button{
-webkit-box-flex:0;
-webkit-flex:0 0 24px;
-ms-flex:0 0 24px;
flex:0 0 24px;
-webkit-box-orient:vertical;
-webkit-box-direction:normal;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column
}
.search_button svg{
margin-top:0
}
.search-input{
height:48px
}
.search-input input{
display:block;
color:#ffffff;
font:16px Roboto, sans-serif;
height:48px;
line-height:48px;
padding:0;
width:100%
}
.search-input input::-webkit-input-placeholder{
color:#ffffff;
opacity:.3
}
.search-input input::-moz-placeholder{
color:#ffffff;
opacity:.3
}
.search-input input:-ms-input-placeholder{
color:#ffffff;
opacity:.3
}
.search-input input::-ms-input-placeholder{
color:#ffffff;
opacity:.3
}
.search-input input::placeholder{
color:#ffffff;
opacity:.3
}
.search-action{
background:0 0;
border:0;
color:#ffffff;
cursor:pointer;
display:none;
height:48px;
margin-top:0
}
.sticky .search-action{
color:#4e4e4e
}
.search.focused .search-action{
display:block
}
.search.focused .search-action:disabled{
opacity:.3
}
.page_body{
position:relative;
z-index:20
}
.page_body .widget{
margin-bottom:16px
}
.page_body .centered{
box-sizing:border-box;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-box-orient:vertical;
-webkit-box-direction:normal;
-webkit-flex-direction:column;
-ms-flex-direction:column;
flex-direction:column;
margin:0 auto;
max-width:922px;
min-height:100vh;
padding:24px 0
}
.page_body .centered>*{
-webkit-box-flex:0;
-webkit-flex:0 0 auto;
-ms-flex:0 0 auto;
flex:0 0 auto
}
.page_body .centered>#footer{
margin-top:auto
}
.blog-name{
margin:24px 0 16px 0
}
.item-view .blog-name,.sticky .blog-name{
box-sizing:border-box;
margin-left:36px;
min-height:48px;
opacity:1;
padding-top:12px
}
.blog-name .subscribe-section-container{
margin-bottom:32px;
text-align:center;
-webkit-transition-property:opacity;
transition-property:opacity;
-webkit-transition-duration:.5s;
transition-duration:.5s
}
.item-view .blog-name .subscribe-section-container,.sticky .blog-name .subscribe-section-container{
margin:0 0 8px 0
}
.blog-name .PageList{
margin-top:16px;
padding-top:8px;
text-align:center
}
.blog-name .PageList .overflowable-contents{
width:100%
}
.blog-name .PageList h3.title{
color:#ffffff;
margin:8px auto;
text-align:center;
width:100%
}
.centered-top-container .blog-name{
-webkit-transition-property:opacity;
transition-property:opacity;
-webkit-transition-duration:.5s;
transition-duration:.5s
}
.item-view .return_link{
margin-bottom:12px;
margin-top:12px;
position:absolute
}
.item-view .blog-name{
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex-wrap:wrap;
-ms-flex-wrap:wrap;
flex-wrap:wrap;
margin:0 48px 27px 48px
}
.item-view .subscribe-section-container{
-webkit-box-flex:0;
-webkit-flex:0 0 auto;
-ms-flex:0 0 auto;
flex:0 0 auto
}
.item-view #header,.item-view .Header{
margin-bottom:5px;
margin-right:15px
}
.item-view .sticky .Header{
margin-bottom:0
}
.item-view .Header p{
margin:10px 0 0 0;
text-align:left
}
.item-view .post-share-buttons-bottom{
margin-right:16px
}
.sticky{
background:#ffffff;
box-shadow:0 0 20px 0 rgba(0,0,0,.7);
box-sizing:border-box;
margin-left:0
}
.sticky #header{
margin-bottom:8px;
margin-right:8px
}
.sticky .centered-top{
margin:4px auto;
max-width:890px;
min-height:48px
}
.sticky .blog-name{
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
margin:0 48px
}
.sticky .blog-name #header{
-webkit-box-flex:0;
-webkit-flex:0 1 auto;
-ms-flex:0 1 auto;
flex:0 1 auto;
-webkit-box-ordinal-group:2;
-webkit-order:1;
-ms-flex-order:1;
order:1;
overflow:hidden
}
.sticky .blog-name .subscribe-section-container{
-webkit-box-flex:0;
-webkit-flex:0 0 auto;
-ms-flex:0 0 auto;
flex:0 0 auto;
-webkit-box-ordinal-group:3;
-webkit-order:2;
-ms-flex-order:2;
order:2
}
.sticky .Header h1{
overflow:hidden;
text-overflow:ellipsis;
white-space:nowrap;
margin-right:-10px;
margin-bottom:-10px;
padding-right:10px;
padding-bottom:10px
}
.sticky .Header p{
display:none
}
.sticky .PageList{
display:none
}
.search-focused>*{
visibility:visible
}
.search-focused .hamburger-menu{
visibility:visible
}
.item-view .search-focused .blog-name,.sticky .search-focused .blog-name{
opacity:0
}
.centered-bottom,.centered-top-container,.centered-top-placeholder{
padding:0 16px
}
.centered-top{
position:relative
}
.item-view .centered-top.search-focused .subscribe-section-container,.sticky .centered-top.search-focused .subscribe-section-container{
opacity:0
}
.page_body.has-vertical-ads .centered .centered-bottom{
display:inline-block;
width:calc(100% - 176px)
}
.Header h1{
color:#ffffff;
font:bold 45px Roboto, sans-serif;
line-height:normal;
margin:0 0 13px 0;
text-align:center;
width:100%
}
.Header h1 a,.Header h1 a:hover,.Header h1 a:visited{
color:#ffffff
}
.item-view .Header h1,.sticky .Header h1{
font-size:24px;
line-height:24px;
margin:0;
text-align:left
}
.sticky .Header h1{
color:#4e4e4e
}
.sticky .Header h1 a,.sticky .Header h1 a:hover,.sticky .Header h1 a:visited{
color:#4e4e4e
}
.Header p{
color:#ffffff;
margin:0 0 13px 0;
opacity:.8;
text-align:center
}
.widget .title{
line-height:28px
}
.BlogArchive li{
font-size:16px
}
.BlogArchive .post-count{
color:#4e4e4e
}
#page_body .FeaturedPost,.Blog .blog-posts .post-outer-container{
background:#ffffff;
min-height:40px;
padding:30px 40px;
width:auto
}
.Blog .blog-posts .post-outer-container:last-child{
margin-bottom:0
}
.Blog .blog-posts .post-outer-container .post-outer{
border:0;
position:relative;
padding-bottom:.25em
}
.post-outer-container{
margin-bottom:16px
}
.post:first-child{
margin-top:0
}
.post .thumb{
float:left;
height:20%;
width:20%
}
.post-share-buttons-bottom,.post-share-buttons-top{
float:right
}
.post-share-buttons-bottom{
margin-right:24px
}
.post-footer,.post-header{
clear:left;
color:rgba(0, 0, 0, 0.54);
margin:0;
width:inherit
}
.blog-pager{
text-align:center
}
.blog-pager a{
color:#2196f3
}
.blog-pager a:visited{
color:#2196f3
}
.blog-pager a:hover{
color:#2196f3
}
.post-title{
font:bold 22px Roboto, sans-serif;
float:left;
margin:0 0 8px 0;
max-width:calc(100% - 48px)
}
.post-title a{
font:bold 30px Roboto, sans-serif
}
.post-title,.post-title a,.post-title a:hover,.post-title a:visited{
color:#3b3b3b
}
.post-body{
color:#4e4e4e;
font:15px Roboto, sans-serif;
line-height:1.6em;
margin:1.5em 0 2em 0;
display:block
}
.post-body img{
height:inherit
}
.post-body .snippet-thumbnail{
float:left;
margin:0;
margin-right:2em;
max-height:128px;
max-width:128px
}
.post-body .snippet-thumbnail img{
max-width:100%
}
.main .FeaturedPost .widget-content{
border:0;
position:relative;
padding-bottom:.25em
}
.FeaturedPost img{
margin-top:2em
}
.FeaturedPost .snippet-container{
margin:2em 0
}
.FeaturedPost .snippet-container p{
margin:0
}
.FeaturedPost .snippet-thumbnail{
float:none;
height:auto;
margin-bottom:2em;
margin-right:0;
overflow:hidden;
max-height:calc(600px + 2em);
max-width:100%;
text-align:center;
width:100%
}
.FeaturedPost .snippet-thumbnail img{
max-width:100%;
width:100%
}
.byline{
color:rgba(0, 0, 0, 0.54);
display:inline-block;
line-height:24px;
margin-top:8px;
vertical-align:top
}
.byline.post-author:first-child{
margin-right:0
}
.byline.reactions .reactions-label{
line-height:22px;
vertical-align:top
}
.byline.post-share-buttons{
position:relative;
display:inline-block;
margin-top:0;
width:100%
}
.byline.post-share-buttons .sharing{
float:right
}
.flat-button.ripple:hover{
background-color:rgba(60,121,167,.12)
}
.flat-button.ripple .splash{
background-color:rgba(60,121,167,.4)
}
a.timestamp-link,a:active.timestamp-link,a:visited.timestamp-link{
color:inherit;
font:inherit;
text-decoration:inherit
}
.post-share-buttons{
margin-left:0
}
.clear-sharing{
min-height:24px
}
.comment-link{
color:#3c79a7;
position:relative
}
.comment-link .num_comments{
margin-left:8px;
vertical-align:top
}
#comment-holder .continue{
display:none
}
#comment-editor{
margin-bottom:20px;
margin-top:20px
}
#comments .comment-form h4,#comments h3.title{
position:absolute;
clip:rect(1px,1px,1px,1px);
padding:0;
border:0;
height:1px;
width:1px;
overflow:hidden
}
.post-filter-message{
background-color:rgba(0,0,0,.7);
color:#fff;
display:table;
margin-bottom:16px;
width:100%
}
.post-filter-message div{
display:table-cell;
padding:15px 28px
}
.post-filter-message div:last-child{
padding-left:0;
text-align:right
}
.post-filter-message a{
white-space:nowrap
}
.post-filter-message .search-label,.post-filter-message .search-query{
font-weight:700;
color:#3c79a7
}
#blog-pager{
margin:2em 0
}
#blog-pager a{
color:#2196f3;
font-size:14px
}
.subscribe-button{
border-color:#ffffff;
color:#ffffff
}
.sticky .subscribe-button{
border-color:#4e4e4e;
color:#4e4e4e
}
.tabs{
margin:0 auto;
padding:0
}
.tabs li{
margin:0 8px;
vertical-align:top
}
.tabs .overflow-button a,.tabs li a{
color:#c6c6c6;
font:700 normal 15px Roboto, sans-serif;
line-height:18px
}
.tabs .overflow-button a{
padding:12px 8px
}
.overflow-popup .tabs li{
text-align:left
}
.overflow-popup li a{
color:#757575;
display:block;
padding:8px 20px
}
.overflow-popup li.selected a{
color:#212121
}
a.report_abuse{
font-weight:400
}
.Label li,.Label span.label-size,.byline.post-labels a{
background-color:#f7f7f7;
border:1px solid #f7f7f7;
border-radius:15px;
display:inline-block;
margin:4px 4px 4px 0;
padding:3px 8px
}
.Label a,.byline.post-labels a{
color:rgba(0, 0, 0, 0.54)
}
.Label ul{
list-style:none;
padding:0
}
.PopularPosts{
background-color:#eeeeee;
padding:30px 40px
}
.PopularPosts .item-content{
color:#757575;
margin-top:24px
}
.PopularPosts a,.PopularPosts a:hover,.PopularPosts a:visited{
color:#2196f3
}
.PopularPosts .post-title,.PopularPosts .post-title a,.PopularPosts .post-title a:hover,.PopularPosts .post-title a:visited{
color:#212121;
font-size:18px;
font-weight:700;
line-height:24px
}
.PopularPosts,.PopularPosts h3.title a{
color:#4e4e4e;
font:15px Roboto, sans-serif
}
.main .PopularPosts{
padding:16px 40px
}
.PopularPosts h3.title{
font-size:14px;
margin:0
}
.PopularPosts h3.post-title{
margin-bottom:0
}
.PopularPosts .byline{
color:rgba(0, 0, 0, 0.54)
}
.PopularPosts .jump-link{
float:right;
margin-top:16px
}
.PopularPosts .post-header .byline{
font-size:.9em;
font-style:italic;
margin-top:6px
}
.PopularPosts ul{
list-style:none;
padding:0;
margin:0
}
.PopularPosts .post{
padding:20px 0
}
.PopularPosts .post+.post{
border-top:1px dashed #c6c6c6
}
.PopularPosts .item-thumbnail{
float:left;
margin-right:32px
}
.PopularPosts .item-thumbnail img{
height:88px;
padding:0;
width:88px
}
.inline-ad{
margin-bottom:16px
}
.desktop-ad .inline-ad{
display:block
}
.adsbygoogle{
overflow:hidden
}
.vertical-ad-container{
float:right;
margin-right:16px;
width:128px
}
.vertical-ad-container .AdSense+.AdSense{
margin-top:16px
}
.inline-ad-placeholder,.vertical-ad-placeholder{
background:#ffffff;
border:1px solid #000;
opacity:.9;
vertical-align:middle;
text-align:center
}
.inline-ad-placeholder span,.vertical-ad-placeholder span{
margin-top:290px;
display:block;
text-transform:uppercase;
font-weight:700;
color:#3b3b3b
}
.vertical-ad-placeholder{
height:600px
}
.vertical-ad-placeholder span{
margin-top:290px;
padding:0 40px
}
.inline-ad-placeholder{
height:90px
}
.inline-ad-placeholder span{
margin-top:36px
}
.Attribution{
color:#757575
}
.Attribution a,.Attribution a:hover,.Attribution a:visited{
color:#2196f3
}
.Attribution svg{
fill:#5b5b5b
}
.sidebar-container{
box-shadow:1px 1px 3px rgba(0,0,0,.1)
}
.sidebar-container,.sidebar-container .sidebar_bottom{
background-color:#ffffff
}
.sidebar-container .navigation,.sidebar-container .sidebar_top_wrapper{
background-color:#ffffff
}
.sidebar-container .sidebar_top{
overflow:auto
}
.sidebar-container .sidebar_bottom{
width:100%;
padding-top:16px
}
.sidebar-container .widget:first-child{
padding-top:0
}
.sidebar_top .widget.Profile{
padding-bottom:16px
}
.widget.Profile{
margin:0;
width:100%
}
.widget.Profile h2{
display:none
}
.widget.Profile h3.title{
color:rgba(0, 0, 0, 0.52);
margin:16px 32px
}
.widget.Profile .individual{
text-align:center
}
.widget.Profile .individual .profile-link{
padding:1em
}
.widget.Profile .individual .default-avatar-wrapper .avatar-icon{
margin:auto
}
.widget.Profile .team{
margin-bottom:32px;
margin-left:32px;
margin-right:32px
}
.widget.Profile ul{
list-style:none;
padding:0
}
.widget.Profile li{
margin:10px 0
}
.widget.Profile .profile-img{
border-radius:50%;
float:none
}
.widget.Profile .profile-link{
color:#212121;
font-size:.9em;
margin-bottom:1em;
opacity:.87;
overflow:hidden
}
.widget.Profile .profile-link.visit-profile{
border-style:solid;
border-width:1px;
border-radius:12px;
cursor:pointer;
font-size:12px;
font-weight:400;
padding:5px 20px;
display:inline-block;
line-height:normal
}
.widget.Profile dd{
color:#757575;
margin:0 16px
}
.widget.Profile location{
margin-bottom:1em
}
.widget.Profile .profile-textblock{
font-size:14px;
line-height:24px;
position:relative
}
body.sidebar-visible .page_body{
overflow-y:scroll
}
body.sidebar-visible .bg-photo-container{
overflow-y:scroll
}
@media screen and (min-width:1440px){
.sidebar-container{
margin-top:470px;
min-height:calc(100% - 470px);
overflow:visible;
z-index:32
}
.sidebar-container .sidebar_top_wrapper{
background-color:#f3f3f3;
height:470px;
margin-top:-470px
}
.sidebar-container .sidebar_top{
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
height:470px;
-webkit-box-orient:horizontal;
-webkit-box-direction:normal;
-webkit-flex-direction:row;
-ms-flex-direction:row;
flex-direction:row;
max-height:470px
}
.sidebar-container .sidebar_bottom{
max-width:284px;
width:284px
}
body.collapsed-header .sidebar-container{
z-index:15
}
.sidebar-container .sidebar_top:empty{
display:none
}
.sidebar-container .sidebar_top>:only-child{
-webkit-box-flex:0;
-webkit-flex:0 0 auto;
-ms-flex:0 0 auto;
flex:0 0 auto;
-webkit-align-self:center;
-ms-flex-item-align:center;
align-self:center;
width:100%
}
.sidebar_top_wrapper.no-items{
display:none
}
}
.post-snippet.snippet-container{
max-height:120px
}
.post-snippet .snippet-item{
line-height:24px
}
.post-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%);
background:linear-gradient(to left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%);
color:#666666;
height:24px
}
.popular-posts-snippet.snippet-container{
max-height:72px
}
.popular-posts-snippet .snippet-item{
line-height:24px
}
.PopularPosts .popular-posts-snippet .snippet-fade{
color:#666666;
height:24px
}
.main .popular-posts-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#eeeeee 0,#eeeeee 20%,rgba(238, 238, 238, 0) 100%);
background:linear-gradient(to left,#eeeeee 0,#eeeeee 20%,rgba(238, 238, 238, 0) 100%)
}
.sidebar_bottom .popular-posts-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%);
background:linear-gradient(to left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%)
}
.profile-snippet.snippet-container{
max-height:192px
}
.has-location .profile-snippet.snippet-container{
max-height:144px
}
.profile-snippet .snippet-item{
line-height:24px
}
.profile-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%);
background:linear-gradient(to left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%);
color:#757575;
height:24px
}
@media screen and (min-width:1440px){
.profile-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#f3f3f3 0,#f3f3f3 20%,rgba(243, 243, 243, 0) 100%);
background:linear-gradient(to left,#f3f3f3 0,#f3f3f3 20%,rgba(243, 243, 243, 0) 100%)
}
}
@media screen and (max-width:800px){
.blog-name{
margin-top:0
}
body.item-view .blog-name{
margin:0 48px
}
.centered-bottom{
padding:8px
}
body.item-view .centered-bottom{
padding:0
}
.page_body .centered{
padding:10px 0
}
body.item-view #header,body.item-view .widget.Header{
margin-right:0
}
body.collapsed-header .centered-top-container .blog-name{
display:block
}
body.collapsed-header .centered-top-container .widget.Header h1{
text-align:center
}
.widget.Header header{
padding:0
}
.widget.Header h1{
font-size:24px;
line-height:24px;
margin-bottom:13px
}
body.item-view .widget.Header h1{
text-align:center
}
body.item-view .widget.Header p{
text-align:center
}
.blog-name .widget.PageList{
padding:0
}
body.item-view .centered-top{
margin-bottom:5px
}
.search-action,.search-input{
margin-bottom:-8px
}
.search form{
margin-bottom:8px
}
body.item-view .subscribe-section-container{
margin:5px 0 0 0;
width:100%
}
#page_body.section div.widget.FeaturedPost,div.widget.PopularPosts{
padding:16px
}
div.widget.Blog .blog-posts .post-outer-container{
padding:16px
}
div.widget.Blog .blog-posts .post-outer-container .post-outer{
padding:0
}
.post:first-child{
margin:0
}
.post-body .snippet-thumbnail{
margin:0 3vw 3vw 0
}
.post-body .snippet-thumbnail img{
height:20vw;
width:20vw;
max-height:128px;
max-width:128px
}
div.widget.PopularPosts div.item-thumbnail{
margin:0 3vw 3vw 0
}
div.widget.PopularPosts div.item-thumbnail img{
height:20vw;
width:20vw;
max-height:88px;
max-width:88px
}
.post-title{
line-height:1
}
.post-title,.post-title a{
font-size:20px
}
#page_body.section div.widget.FeaturedPost h3 a{
font-size:22px
}
.mobile-ad .inline-ad{
display:block
}
.page_body.has-vertical-ads .vertical-ad-container,.page_body.has-vertical-ads .vertical-ad-container ins{
display:none
}
.page_body.has-vertical-ads .centered .centered-bottom,.page_body.has-vertical-ads .centered .centered-top{
display:block;
width:auto
}
div.post-filter-message div{
padding:8px 16px
}
}
@media screen and (min-width:1440px){
body{
position:relative
}
body.item-view .blog-name{
margin-left:48px
}
.page_body{
margin-left:284px
}
.search{
margin-left:0
}
.search.focused{
width:100%
}
.sticky{
padding-left:284px
}
.hamburger-menu{
display:none
}
body.collapsed-header .page_body .centered-top-container{
padding-left:284px;
padding-right:0;
width:100%
}
body.collapsed-header .centered-top-container .search.focused{
width:100%
}
body.collapsed-header .centered-top-container .blog-name{
margin-left:0
}
body.collapsed-header.item-view .centered-top-container .search.focused{
width:calc(100% - 50px)
}
body.collapsed-header.item-view .centered-top-container .blog-name{
margin-left:40px
}
}
--></style>
<style id='template-skin-1' type='text/css'><!--
body#layout .hidden,
body#layout .invisible {
display: inherit;
}
body#layout .navigation {
display: none;
}
body#layout .page,
body#layout .sidebar_top,
body#layout .sidebar_bottom {
display: inline-block;
left: inherit;
position: relative;
vertical-align: top;
}
body#layout .page {
float: right;
margin-left: 20px;
width: 55%;
}
body#layout .sidebar-container {
float: right;
width: 40%;
}
body#layout .hamburger-menu {
display: none;
}
--></style>
<style>
    .bg-photo {background-image:url(http\:\/\/2.bp.blogspot.com\/-x4SlpiHfSJ8\/Vyjtmvpt5kI\/AAAAAAAADn4\/7NTxE5yxeE8_M58uwT6AoZ3W6P9sxB6TwCK4B\/s1600\/newton_cropped.jpg);}
    
@media (max-width: 480px) { .bg-photo {background-image:url(http\:\/\/2.bp.blogspot.com\/-x4SlpiHfSJ8\/Vyjtmvpt5kI\/AAAAAAAADn4\/7NTxE5yxeE8_M58uwT6AoZ3W6P9sxB6TwCK4B\/w480\/newton_cropped.jpg);}}
@media (max-width: 640px) and (min-width: 481px) { .bg-photo {background-image:url(http\:\/\/2.bp.blogspot.com\/-x4SlpiHfSJ8\/Vyjtmvpt5kI\/AAAAAAAADn4\/7NTxE5yxeE8_M58uwT6AoZ3W6P9sxB6TwCK4B\/w640\/newton_cropped.jpg);}}
@media (max-width: 800px) and (min-width: 641px) { .bg-photo {background-image:url(http\:\/\/2.bp.blogspot.com\/-x4SlpiHfSJ8\/Vyjtmvpt5kI\/AAAAAAAADn4\/7NTxE5yxeE8_M58uwT6AoZ3W6P9sxB6TwCK4B\/w800\/newton_cropped.jpg);}}
@media (max-width: 1200px) and (min-width: 801px) { .bg-photo {background-image:url(http\:\/\/2.bp.blogspot.com\/-x4SlpiHfSJ8\/Vyjtmvpt5kI\/AAAAAAAADn4\/7NTxE5yxeE8_M58uwT6AoZ3W6P9sxB6TwCK4B\/w1200\/newton_cropped.jpg);}}
/* Last tag covers anything over one higher than the previous max-size cap. */
@media (min-width: 1201px) { .bg-photo {background-image:url(http\:\/\/2.bp.blogspot.com\/-x4SlpiHfSJ8\/Vyjtmvpt5kI\/AAAAAAAADn4\/7NTxE5yxeE8_M58uwT6AoZ3W6P9sxB6TwCK4B\/w1600\/newton_cropped.jpg);}}
  </style>
<script async='async' src='//www.gstatic.com/external_hosted/clipboardjs/clipboard.min.js'></script>
<!-- START: ADDED BY AMIR -->
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
  },
  "HTML-CSS": { availableFonts: ["TeX"] }
  });
    </script>
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML' type='text/javascript'>
    </script>
<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'/>
<!-- END: ADDED BY AMIR -->
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=5825758052688213474&amp;zx=5e2ad629-d23a-49a7-a013-9294d5a6515f' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=5825758052688213474&amp;zx=5e2ad629-d23a-49a7-a013-9294d5a6515f' rel='stylesheet'/></noscript>

</head>
<body class='item-view variant-indie_light'>
<a class='skip-navigation' href='#main' tabindex='0'>
Skip to main content
</a>
<div class='page'>
<div class='bg-photo-overlay'></div>
<div class='bg-photo-container'>
<div class='bg-photo'></div>
</div>
<div class='page_body'>
<div class='centered'>
<div class='centered-top-placeholder'></div>
<header class='centered-top-container' role='banner'>
<div class='centered-top'>
<a class='return_link' href='http://www.unofficialgoogledatascience.com/'>
<button class='svg-icon-24-button back-button rtl-reversible-icon flat-icon-button ripple'>
<svg class='svg-icon-24'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_arrow_back_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
</button>
</a>
<div class='search'>
<button aria-label='Search' class='search-expand touch-icon-button'>
<div class='flat-icon-button ripple'>
<svg class='svg-icon-24 search-expand-icon'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_search_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
</div>
</button>
<div class='section' id='search_top' name='Search (Top)'><div class='widget BlogSearch' data-version='2' id='BlogSearch1'>
<h3 class='title'>
Search This Blog
</h3>
<div class='widget-content' role='search'>
<form action='http://www.unofficialgoogledatascience.com/search' target='_top'>
<div class='search-input'>
<input aria-label='Search this blog' autocomplete='off' name='q' placeholder='Search this blog' value=''/>
</div>
<input class='search-action' type='submit' value='Search'/>
</form>
</div>
</div></div>
</div>
<div class='clearboth'></div>
<div class='blog-name container'>
<div class='container section' id='header' name='Header'><div class='widget Header' data-version='2' id='Header1'>
<div class='header-widget'>
<div>
<h1>
<a href='http://www.unofficialgoogledatascience.com/'>
The Unofficial Google Data Science Blog
</a>
</h1>
</div>
<p>
</p>
</div>
</div></div>
<nav role='navigation'>
<div class='clearboth section' id='page_list_top' name='Page List (Top)'><div class='widget PageList' data-version='2' id='PageList1'>
<div class='widget-content'>
<div class='overflowable-container'>
<div class='overflowable-contents'>
<div class='container'>
<ul class='tabs'>
<li class='overflowable-item'>
<a href='http://www.unofficialgoogledatascience.com/'>Home</a>
</li>
<li class='overflowable-item'>
<a href='http://www.unofficialgoogledatascience.com/p/about.html'>About this blog</a>
</li>
</ul>
</div>
</div>
<div class='overflow-button hidden'>
<a class='flat-button'>More&hellip;</a>
</div>
</div>
</div>
</div></div>
</nav>
</div>
</div>
</header>
<div>
<div class='vertical-ad-container no-items section' id='ads' name='Ads'>
</div>
<main class='centered-bottom' id='main' role='main' tabindex='-1'>
<div class='main section' id='page_body' name='Page Body'>
<div class='widget Blog' data-version='2' id='Blog1'>
<div class='blog-posts hfeed container'>
<article class='post-outer-container'>
<div class='post-outer'>
<div class='post'>
<script type='application/ld+json'>{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html"
  },
  "headline": "Next generation tools for data science","description": "By DAVID ADAMS\u003ci\u003e Since inception, this blog has defined &#8220;data science&#8221;  as inference derived from data too big to fit on a single computer. Thus the abil&#8230;","datePublished": "2016-08-31T23:24:00-07:00",
  "dateModified": "2017-02-01T19:35:56-08:00","image": {
    "@type": "ImageObject","url": "https://lh4.googleusercontent.com/OlvW6SskdqiFWmJeucVj-ESXH7c_GR_0af4Rdo0vDi78eVKVbusCTlbs7UouymD-cfxszDarNsIUexlyuInZ15Wgm6hTGpPVzo7spMvv1mNsf95qlxP5kEKjGMBtPfeyUB-E1qYU=w1200-h630-p-k-no-nu",
    "height": 630,
    "width": 1200},"publisher": {
    "@type": "Organization",
    "name": "Blogger",
    "logo": {
      "@type": "ImageObject",
      "url": "https://lh3.googleusercontent.com/ULB6iBuCeTVvSjjjU1A-O8e9ZpVba6uvyhtiWRti_rBAs9yMYOFBujxriJRZ-A=h60",
      "width": 206,
      "height": 60
    }
  },"author": {
    "@type": "Person",
    "name": "Amir Najmi"
  }
}</script>
<a name='5882522097717497514'></a>
<h3 class='post-title entry-title'>
Next generation tools for data science
</h3>
<div class='post-share-buttons post-share-buttons-top'>
<div class='byline post-share-buttons goog-inline-block'>
<div aria-owns='sharing-popup-Blog1-byline-5882522097717497514' class='sharing' data-title='Next generation tools for data science'>
<button aria-controls='sharing-popup-Blog1-byline-5882522097717497514' aria-label='Share' class='sharing-button touch-icon-button' id='sharing-button-Blog1-byline-5882522097717497514' role='button'>
<div class='flat-icon-button ripple'>
<svg class='svg-icon-24'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_share_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
</div>
</button>
<div class='share-buttons-container'>
<ul aria-hidden='true' aria-label='Share' class='share-buttons hidden' id='sharing-popup-Blog1-byline-5882522097717497514' role='menu'>
<li>
<span aria-label='Get link' class='sharing-platform-button sharing-element-link' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Get link'>
<svg class='svg-icon-24 touch-icon sharing-link'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_link_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Get link</span>
</span>
</li>
<li>
<span aria-label='Share to Facebook' class='sharing-platform-button sharing-element-facebook' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=facebook' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Share to Facebook'>
<svg class='svg-icon-24 touch-icon sharing-facebook'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_facebook_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Facebook</span>
</span>
</li>
<li>
<span aria-label='Share to Twitter' class='sharing-platform-button sharing-element-twitter' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=twitter' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Share to Twitter'>
<svg class='svg-icon-24 touch-icon sharing-twitter'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_twitter_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Twitter</span>
</span>
</li>
<li>
<span aria-label='Share to Pinterest' class='sharing-platform-button sharing-element-pinterest' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=pinterest' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Share to Pinterest'>
<svg class='svg-icon-24 touch-icon sharing-pinterest'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_pinterest_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Pinterest</span>
</span>
</li>
<li>
<span aria-label='Email' class='sharing-platform-button sharing-element-email' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=email' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Email'>
<svg class='svg-icon-24 touch-icon sharing-email'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_email_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Email</span>
</span>
</li>
<li aria-hidden='true' class='hidden'>
<span aria-label='Share to other apps' class='sharing-platform-button sharing-element-other' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Share to other apps'>
<svg class='svg-icon-24 touch-icon sharing-sharingOther'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_more_horiz_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Other Apps</span>
</span>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class='post-header'>
<div class='post-header-line-1'>
<span class='byline post-timestamp'>
<meta content='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html'/>
<a class='timestamp-link' href='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' rel='bookmark' title='permanent link'>
<time class='published' datetime='2016-08-31T23:24:00-07:00' title='2016-08-31T23:24:00-07:00'>
August 31, 2016
</time>
</a>
</span>
</div>
</div>
<div class='post-body entry-content float-container' id='post-body-5882522097717497514'>
By DAVID ADAMS<br />
<br />
<i>Since inception, <a href="http://www.unofficialgoogledatascience.com/2015/08/welcome-to-unofficial-google-data.html">this blog has defined &#8220;data science&#8221;</a> as inference derived from data too big to fit on a single computer. Thus the ability to manipulate big data is essential to our notion of data science. While MapReduce remains a fundamental tool, many interesting analyses require more than it can offer. For instance, the well-known Mantel-Haenszel estimator cannot be implemented in a single MapReduce. <b>Apache Spark</b> and <b>Google Cloud Dataflow</b> represent two alternatives as &#8220;next generation&#8221; data processing frameworks. This post compares the two, relying on the author&#8217;s first-hand experience and subsequent background research.</i><br />
<br />
<h2>
Introduction</h2>
<br />
<div>
That MapReduce was <b>the</b> solution to write data processing pipelines scalable to hundreds of terabytes (or more) is evidenced by the massive uptake. This was true within Google as well as outside of Google in the form of Hadoop/MapReduce (for some &#8220;Hadoop&#8221; and &#8220;data science&#8221; are synonyms). However, it didn&#8217;t take long for the pain of writing and running many-stage MapReduce programs to become apparent. MapReduce&#8217;s limitations motivated two different groups, AMPLab (Apache Spark) and Google (Cloud Dataflow), to write next-generation data processing frameworks. The two groups came at the problem from different vantage points and this can be seen in both obvious and subtle differences in the end-products. Dataflow was designed as a marriage of Google frameworks for expressing complex batch pipelines (FlumeJava) and streaming (MillWheel) pipelines.  Spark was developed <a href="http://blog.madhukaraphatak.com/history-of-spark/">at UC Berkeley to enable exploratory analysis and ML at scale</a>.<br />
<br />
Six months ago, <a href="https://cloud.google.com/blog/big-data/2016/08/cloud-dataflow-apache-beam-and-you">Google donated the Cloud Dataflow programming model and SDKs to the Apache Software Foundation</a>, resulting in the incubating project <a href="http://beam.incubator.apache.org/"><i>Apache Beam</i></a>. Going forward, <i>Apache Beam</i> will become the way to express data processing pipelines, while <a href="https://cloud.google.com/dataflow/"><i>Cloud Dataflow</i></a> remains as a fully managed service for executing these pipelines. Similarly, I&#8217;ll refer to the programming model and API as <i>Beam</i> and the service that runs on GCP as <i>Dataflow</i>. Example code in this post uses the current Dataflow SDK, but similar concepts and programming patterns hold in Apache Beam.<br />
<br />
In this post, I&#8217;m going to shed light on the similarities and differences of Spark and Beam/Dataflow. For framing purposes, <b>Spark&#8217;s sweet spot is quickly developing exploratory/interactive analysis and iterative algorithms</b>, e.g., gradient descent and MCMC, whereas <b>Dataflow&#8217;s sweet spot is processing streaming data and highly-optimized, robust, fixed pipelines</b>.<br />
<br />
The rest of the post is organized as follows: the most important difference between the two, a motivating example with implementations in Spark and Beam/Dataflow, an example of an clustering algorithm written in Spark, examples of streaming processing in Spark and Dataflow, and finally, other major differences between the frameworks.<br />
<br />
<h2>
When MapReduce is not enough</h2>
MapReduce is a great tool for single-stage parallel data processing. A few pain points emerge when trying to use MapReduce beyond small pipelines:<br />
<ul>
<li>Expressing complex pipelines requires significant boilerplate, separate programs, and the &#8220;interface&#8221; between stages to be files.</li>
<li>Writing intermediate results to disk between stages of pipelines is a serious bottleneck and forces the user to hand-optimize the placement of these divisions</li>
<li>Performing exploratory analysis requires reading and writing to disk, which is slow</li>
<li>Expressing streaming pipelines (low-latency and infinite data sources) is not supported,</li>
<li>Writing multi-stage pipelines are easily to stumble upon, take for example trying to measure the effects of a randomized experiment on ratios of metrics using Mantel-Haenszel (see more below).</li>
</ul>
Both Beam and Spark solve most of these problems storing results of MapReduce steps in by optimizing away many steps and storing necessary intermediate results in memory, <i>PCollections</i> for Dataflow and <i>resilient distributed dataset</i> (RDD) for Spark, instead of writing to disk just to load back into memory again.</div>
<div>
<br /></div>
<h2>
The core difference: graph evaluation</h2>
The fundamental and enduring difference between Spark and Beam is that Spark only builds as much of the computation graph as needed (for lazy evaluation on actions) whereas Dataflow builds the entire computation graph before it is optimized and sent to the service or cluster to be executed.  Many significant differences between the two are a consequence of this distinction. Thus it is easy to use Spark for interactive analysis (from a python or scala shell) and to prototype ML algorithms but harder to do so in Dataflow. To be clear, it isn&#8217;t that one cannot do ML with Dataflow &#8212; single pass, streaming algorithms are fine. But many ML algorithms, such as basic gradient descent and MCMC, make data-driven decisions of how many iterations they need to run until convergence. Spark provides the user with greater flexibility.<br />
<br />
On the other hand, the benefits of requiring a complete computation graph are that it allows systems that execute Beam pipelines, like Dataflow to optimize <b>the complete graph</b>. More importantly, decoupling graph construction from execution lets Beam create a language-agnostic representation of the computation graph. Thus, Dataflow graphs can be executed on other distributed processing back-ends, even including Spark. This property is what enabled the creation of the <a href="http://beam.incubator.apache.org/">Apache Beam project</a>.<br />
<br />
Another consequence of Beam&#8217;s decision to require specification of the full computation graph is that Dataflow may be offered as a service. This <i>running-a-pipeline-job-as-a-service</i> takes a graph specification and data inputs and produces outputs. The <a href="https://cloud.google.com/dataflow/">Cloud Dataflow Service</a> can be thought of as a black box where details such as the number of VMs to use, overall or per stage, or distribution of work can all be left up to the service. Of course, most of these details can be specified if desired, <a href="https://cloud.google.com/blog/big-data/2016/03/comparing-cloud-dataflow-autoscaling-to-spark-and-hadoop">see here</a> for a more expansive discussion. This is in stark comparison to Spark, which is cluster-oriented instead of job-oriented. To run a fixed pipeline in Spark requires spinning up a Spark cluster, running the pipeline and tearing the cluster down. Even though there are tools to make this process easier (see <a href="https://cloud.google.com/dataproc/">Cloud Dataproc</a> on GCP or <a href="https://databricks.com/">Databricks</a> on AWS) cluster management remains the responsibility of the user.<br />
<div>
<br />
<h2>
A motivating example for going beyond Hadoop/MapReduce</h2>
To compare the two frameworks, I&#8217;m going to solve the same problem twice then highlight key differences. Suppose we have on an online auction site with a wide variety of products for sale. Users browse the images and specifications of products in the inventory and may choose to bid on them. Because it is an auction site, prices for any item vary all the time. Products range in value from a few dollars (emoji eraser kits) to thousands (nitro coffee kits) so an important way we track them is by product category.<br />
<br />
We want to run a randomized control experiment to determine the effect of high-resolution images on our sales. Say, we wish to determine the impact of the experiment on average sell price. The naive thing to do would be simply to compare the average selling price of treatment to that of control. However this could be misleading &#8212; this measure will show a difference even if the price for each individual item remained constant and only the mix of products sold was affected. To be concrete, imagine the experiment caused us to sell relatively more nitro coffee kits than emoji kits. The <b>Mantel-Haenszel estimator</b> (also known as Cochran-Mantel-Haenszel) is meant precisely to address this problem by adjusting for the mix of items being compared between treatment and control. The basic idea is first to compute the average price separately in treatment and control for each individual stratum (aka "slice") and then to take the ratio of weighted combination of prices in treatment to that of control. The key is that the combination weights are the same for treatment and control, and these are chosen in some way to minimize estimator variance.<br />
<br />
Widely used in medicine for count data, the MH estimator and its generalizations are ubiquitous within data science at Google. In a future post we will cover applications and extensions of MH to analytic problems at Google. For now, we'll just go ahead and compute point MH estimates for this (non-count) price data, using product categories as our slices. Let's say in product category $i$ we sell $n_{t,i}$ and $n_{c,i}$ items in treatment and control respectively for a total sale value of $X_{t,i}$ and $X_{c,i}$. The MH estimate for the (mix-adjusted) ratio of prices between treatment and control is<br />
$$<br />
MH(t,c)=\frac{\sum_i w_i \frac{X_{t,i}}{n_{t,i}}} {\sum_i w_i \frac{X_{c,i}}{n_{c,i}}}<br />
$$ where the weights $w_i$ is the harmonic mean of $n_{t,i}$ and $n_{c,i}$. To facilitate computation, we will rewrite the formula as<br />
$$<br />
MH(t,c)=\frac{\sum_i&nbsp;X_{t,i} \left(\frac{n_{c,i}}{n_{t,i} + n_{c,i}}\right)}<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{\sum_i&nbsp;X_{c,i} \left(\frac{n_{t,i}}{n_{t,i}&nbsp;+ n_{c,i}}\right)}<br />
$$ taking care to omit terms where $n_{t,i}&nbsp;+ n_{c,i} = 0$. Let's start with a csv of the following schema:</div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><experiment_id><product_id><selling_price>&nbsp;exp_id, product_id, price, sale_count <count></count></selling_price></product_id></experiment_id></span><br />
If I wrote a MapReduce pipeline to calculate the MH ratio of prices, it would require three MapReduce programs:<br />
<ol>
<li><b>Map</b> (if header skip else <product_id exp_id=""> value <price clicks="">) &#8594; Reduce (sum reducer)</price></product_id></li>
<li><b>Map</b> (key <product_id> value <exp_id clicks="" price="">) &#8594; Reduce (no-op -- value is iter<exp_id clicks="" price="">)</exp_id></exp_id></product_id></li>
<li><b>Map</b> (key &lt;&gt; value <numerator denominator="">) &#8594; Reduce (sum reducer)</numerator></li>
</ol>
The net result would be a significant amount of code, considering a trivial word-count MapReduce requires roughly <a href="https://hadoop.apache.org/docs/r1.2.1/mapred_tutorial.html">60 lines of mostly boilerplate Java code</a>. That&#8217;s a lot of code that I&#8217;m not going to write. For the curious reader, much has been written about Hadoop/Mapreduce versus Spark, such as&nbsp;<a href="http://www.dattamsha.com/2014/09/hadoop-mr-vs-spark-rdd-wordcount-program/">this post at Dattamsha</a>.</div>
<div>
<br /></div>
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><img alt="Compare Spark vs. Google Dataflow/Beam" height="329" src="https://lh4.googleusercontent.com/OlvW6SskdqiFWmJeucVj-ESXH7c_GR_0af4Rdo0vDi78eVKVbusCTlbs7UouymD-cfxszDarNsIUexlyuInZ15Wgm6hTGpPVzo7spMvv1mNsf95qlxP5kEKjGMBtPfeyUB-E1qYU" style="border: none; margin-left: auto; margin-right: auto; transform: rotate(0rad);" title="" width="640" /></td></tr>
<tr><td class="tr-caption">A mashup of Apache Spark and Dataflow/Beam</td></tr>
</tbody></table>
<div>
<h2>
MH in python</h2>
Readers who prefer Python to prose can see the full Jupyter notebook solution in my <a href="https://github.com/davidadamsphd/spark-vs-dataflow">Spark vs Dataflow</a> github project. To make the comparison easier, I separate the business logic from parallelized code. There are two business logic functions, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">calc_numerator</span> and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">calc_denominator</span>, that take all of count and price data for a particular product and calculate the numerator (and denominator) of the above formula.</div>
<div>
<h4>
MH in Apache Spark</h4>
The first thing to do for Spark is start the Spark shell, which involves adding the a few things to the PATH and running execfile on pyspark/shell.py (see the notebook for details).&nbsp;Next comes the Spark code:<br />
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;"><br /></span></span>
<span id="docs-internal-guid-70f625c1-e499-b463-fa8e-c4933f8d3367" style="background-color: white;"><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">  from</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: blue; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">operator</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">import</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> add</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">  # We want to calculate MH(v_{t,i},n_{t,i},v_{c,i},n_{c,i}), where t and c are treatment </span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">  # </span></span><span style="background-color: white; color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; line-height: 20.4001px; white-space: pre-wrap;">and control.</span><span style="background-color: white; color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; line-height: 1.45715; white-space: pre-wrap;"> v and n in our cases are value of the sale prices and sale_count.</span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  input_rdd </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> sc</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">textFile(</span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">'sim_data_{0}_{1}.csv'</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">format(NUM_LE, NUM_HE))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  header </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> input_rdd</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">first() </span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># Remove the first line.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  parsed_input_rdd </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> input_rdd</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">filter(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> x: x </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">!=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">header)</span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">                              .</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> x: convert_line(x</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">split(</span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">','</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">)))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  transformed </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> parsed_input_rdd</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> x: ((x[exp], x[prod]),</span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">                                                (x[sale_count]</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">*</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">x[price], x[sale_count])))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br /></span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  (sp, clks) </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> (</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">, </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">) </span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># sale price and sale_count</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  (ep, spc) </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> (</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">, </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">) </span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># exp_id&amp;product_id, sp&amp;sale_count</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  (exp2, prod2) </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> (</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">, </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">) </span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># exp_id, product_id</span></span><br />
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><span style="color: #408080;"><i><br class="kix-line-break" /></i></span></span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">  # For each product cross exp_id, sum the sale prices and sale_count</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  grouped_result </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> transformed</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">reduceByKey(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> x,y: (x[sp]</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">+</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">y[sp], x[clks]</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">+</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">y[clks]))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  grouped_by_product </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> grouped_result</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> x: ((x[ep][prod2]), (x[ep][exp2], x[spc][sp], x[spc][clks])))</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">groupByKey()</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span></span><span id="docs-internal-guid-70f625c1-e644-8f9c-7969-e79933367c86"></span></div>
<div>
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br /></span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  numerator_sum </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> grouped_by_product</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> x: calc_numerator(x))</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">reduce(add)</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  denominator_sum </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> grouped_by_product</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> x: calc_denominator(x))</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">reduce(add)</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  effect </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> numerator_sum </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">/</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> denominator_sum</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  print</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">(numerator_sum, denominator_sum, effect)</span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: #f7f7f7; color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br /></span></div>
</div>
<div>
<div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;">
Spark functions fall into two categories: <b>transformations</b> that manipulate the data record by record (e.g., map and filter), and <b>actions</b> that cause the data to be reorganized (e.g., <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">groupByKey</span>, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">reduceByKey</span>). The significance of the distinction is that transformations have no immediate effect and are only acted upon when an action is reached, that is, Spark does lazy evaluation.&nbsp;</div>
<div dir="ltr" style="margin-bottom: 0pt; margin-top: 0pt;">
<br />
Excluding business-logic, the program is only a handful of lines of code.</div>
<ul>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sc.textFile(...)</span> transforms a file on disk into an RDD (the distributed data structure in Spark)</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">input_rdd.first()&nbsp;</span>acts on the RDD returning first, header, element to the driver (my notebook).</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">input_rdd.filter(...).map(...)</span> transforms <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">input_rdd</span> removing the header then converts each csv line into floats and ints.</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">parsed_input_rdd.map(...)</span> transforms records into key-value tuples <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">((exp_id, product_id), (cost, clicks))</span></li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">transformed.reduceByKey(...)</span> acts on transformed causing <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">input_rdd.filter(...).map(...)</span> and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">parsed_input_rdd.map(...)</span> to be executed and produces the total clicks and cost by <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">(exp_id, product_id)</span></li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">grouped_result.map(...).groupByKey()&nbsp;</span>acts to produce the same data, only grouped by <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">product_id</span> instead of <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">product_id</span> and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">experiment_id</span>.&nbsp;</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">grouped_by_product.map(...).reduce(add)</span> transforms the data per <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">product_id</span> into the numerator and denominator of the MH calculation and then performs the action of summing the results using the <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">add</span> function.</li>
</ul>
<div dir="ltr" style="margin-bottom: 0pt; margin-top: 0pt;">
</div>
<h4>
<span style="vertical-align: baseline;">MH in Apache Beam</span></h4>
<span style="vertical-align: baseline;">The organization of the Dataflow code is rather similar to Spark overall, with a handful of subtle, but important distinctions. One of the less interesting differences is that Dataflow doesn&#8217;t yet have a sum function for the reduce, so I have to write my own (<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">t_sum</span>). Note that this code is using the Dataflow SDK (not the new <a href="https://github.com/apache/incubator-beam/tree/python-sdk/sdks/python">Beam SDK</a>).</span><br />
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span id="docs-internal-guid-70f625c1-e651-fd73-b71c-3e6ecef5983d" style="background-color: white;"></span><br />
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  import</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: blue; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">apache_beam</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">as</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: blue; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">beam</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  def</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: blue; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">t_sum</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">(values):</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;result </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> [</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">,</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">]</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">for</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> v </span><span style="color: #aa22ff; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">in</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> values:</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result[</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">+=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> v[</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">]</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result[</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">+=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> v[</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">]</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">return</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (result[</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">], result[</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">])</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  # Create a pipeline executing on a direct runner (local, non-cloud).</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  # DirectPipelineRunner is the default runner, I'm setting it here to show how one</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  # would change it to run on the Dataflow Service.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  pipeline_options </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">utils</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">options</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">PipelineOptions([</span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'--runner=DirectPipelineRunner'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">])</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  p </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Pipeline(options</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">pipeline_options)</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  parsed_input_rdd </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (p</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'load records'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">     beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">io</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Read(beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">io</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">TextFileSource(</span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'sim_data_{0}_{1}.csv'</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">format(NUM_LE, NUM_HE)))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'filter header'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Filter(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> x: x[</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">] </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">!=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'#'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">)</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'split line'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> x: convert_line(x</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">split(</span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">','</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">))))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  transformed </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (parsed_input_rdd</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'reshape'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Map((</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> x: ((x[exp], x[prod]),</span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">                                       (x[price]</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">*</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">x[sale_count], x[sale_count])))))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  (sp, clks) </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">) </span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"># sale price and sale_count</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  (ep, spc) </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">) </span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"># exp_id&amp;product_id, sp&amp;sale_count</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  (exp2, prod2) </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">) </span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"># exp_id, product_id</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #408080; font-family: &quot;courier new&quot;; font-size: 14px; font-style: italic; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  # For each product cross exp_id, sum the sale prices and sale_count</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  grouped_result </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (transformed</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'combine per product/id'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CombinePerKey(t_sum))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  grouped_by_product </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (grouped_result</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'keyByExpProduct'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> x: ((x[ep][prod2]),</span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">                                              (x[ep][exp2], x[spc][sp], x[spc][clks])))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'group'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">GroupByKey())</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  numerator_sum </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (grouped_by_product</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'MapForNum'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> x: calc_numerator(x))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'CombineNum'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CombineGlobally(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">sum</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  numerator_sum </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'save numerator'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">io</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Write(beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">io</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">TextFileSink(</span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'./numerator_sum'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  denominator_sum </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> (grouped_by_product</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'MapForDenom'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Map(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 700; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> x: calc_denominator(x))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">   </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'CombineDenom'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">CombineGlobally(</span><span style="color: green; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">sum</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  denominator_sum </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">|</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'save denominator'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&gt;&gt;</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white;"><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">     beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">io</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Write(beam</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">io</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">TextFileSink(</span><span style="color: #ba2121; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">'./denominator_sum'</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">))</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">  p</span><span style="color: #666666; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-family: &quot;courier new&quot;; font-size: 14px; font-style: normal; font-weight: 400; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">run()</span></span></div>
</div>
<br />
Beam is conceptually two pieces: pipeline construction and pipeline execution. <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">beam.Pipeline()</span> returns a pipeline, say <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">p</span>, on which to build (using <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">beam.Map</span>, <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">beam.GroupByKey,</span> etc.) and <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">p.run()</span> executes the pipeline on a cluster, by the Dataflow Service, or in our case, locally.<br />
<ul>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">beam.Pipeline(options=pipeline_options)</span> begins constructing a pipeline to run locally.&nbsp;</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">p | beam.io.Read(...) | beam.Filter(...) | beam.Map(...) </span>add reading the file, filtering lines that look like the header (starting with &#8216;#&#8217;), converting each line into floats and ints to the graph.</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">parsed_input_rdd | beam.Map(...)</span> adds mapping each record to be keyed by <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">exp_id, product_id</span> to the graph</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">transformed | beam.CombinePerKey(...) | beam.Map(...) | beam.GroupByKey()&nbsp;</span>adds summing clicks and cost by <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">exp_id, product_id</span> and regrouping by <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">product_id</span> to the graph</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">grouped_by_product | beam.Map(...) | beam.CombineGlobally(...)</span> adds calculating the numerator/denominator values and the global sum to the graph</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">numerator_sum | beam.Write(...)</span> adds a sync for the numerator (there is a matching output for the denominator).</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">p.run()</span> optimizes constructed graph and ships the result to be executed (in our case the local machine)</li>
</ul>
<h4>
Comparison of implementations</h4>
At a high-level, both implementations look similar and use the same basic parallel operations. The first difference to point out is that Spark <b>executes</b> the graph only on <b>actions</b>, e.g., <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">reduceByKey</span>, whereas the runner executing Beam, e.g., Cloud Dataflow, executes the complete graph (when run is invoked). Another difference is that Dataflow graphs require <b>sources</b> and <b>sinks</b>, which means results must be <b>piped</b> to files and cannot be returned to the calling program (with the exception of using the local runner).<br />
<br /></div>
<div>
<h2>
Spark&#8217;s sweet-spot: iterative algorithms</h2>
Spark started as a <a href="http://blog.madhukaraphatak.com/history-of-spark/">solution for doing exploratory analysis and Machine Learning</a>. One of the simplest ways to show this off is the clustering technique <a href="https://en.wikipedia.org/wiki/K-means_clustering">k-means clustering</a>. K-means works by repeatedly applying two steps, assigning points to clusters and updating cluster centers, until the location of the cluster centers have stabilized. Below is the core of the algorithm written in Spark.<br />
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: #f7f7f7; color: #408080; font-family: &quot;arial&quot;; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">
</span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span style="color: #408080; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">  # Load the data, remove the first line, and pick initial locations for the clusters.</span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span style="color: #408080; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">  # We put the x,y points in pt_rdd, and RDD of PtAgg (a class containing x, y,</span></span></div>
<div dir="ltr" style="line-height: 1.4571514285714287; margin-bottom: 0pt; margin-top: 0pt;">
<span style="background-color: white; font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><span style="color: #408080; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">  # and count).</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  pt_rdd </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> parsed_input_rdd</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">map(</span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> x: PtAgg(x[</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">], x[</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">], </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">))</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  MAX_STEPS </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">100; </span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">&nbsp;MIN_DELTA </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">0.001</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">; delta </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">1.0</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">; step </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">  while</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> delta </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">&gt;</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> MIN_DELTA </span><span style="color: #aa22ff; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">and</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> step </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">&lt;</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> MAX_STEPS:</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;step </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">+=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">1</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;c_centers_old </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> copy</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">deepcopy(c_centers)</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;b_c_centers </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> sc</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">broadcast(c_centers_old)</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;</span><span style="color: #408080; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># For every point, find the cluster its closer to and add to its total x, y, and count</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;totals </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> pt_rdd</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">map(</span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> x: pick_closest_center(x, b_c_centers</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">value))</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">reduce(</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">lambda</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> a,b: center_reduce(a,b))</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;</span><span style="color: #408080; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># Now update the location of the centers as the mean of all of the points closest to it</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;</span><span style="color: #408080; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># (unless there are none, in which case pick a new random spot).</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;c_centers </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> [t</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">Normalize() </span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">if</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> t</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">cnt </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">!=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">else</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> random_point_location() </span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">for</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> t </span><span style="color: #aa22ff; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">in</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> totals]</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;</span><span style="color: #408080; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># compute the distance that each cluster center moves, the set the max of those as</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;</span><span style="color: #408080; font-size: 14px; font-style: italic; vertical-align: baseline; white-space: pre-wrap;"># the delta used to the stop condition.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;deltas </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> [math</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">sqrt(c</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">DistSqr(c_old)) </span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">for</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> c, c_old </span><span style="color: #aa22ff; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">in</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: green; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">zip</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">(c_centers, c_centers_old)]</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;delta </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: green; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">max</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">(deltas)</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">  s </span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">=</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="color: #ba2121; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">' '</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">join([</span><span style="color: green; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">str</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">(x) </span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">for</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> x </span><span style="color: #aa22ff; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">in</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"> c_centers])</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="color: green; font-size: 14px; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">  print</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">(</span><span style="color: #ba2121; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">'final centers: {0}'</span><span style="color: #666666; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="color: #333333; font-size: 14px; vertical-align: baseline; white-space: pre-wrap;">format(s))</span></span></div>
<ul>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">parsed_input_rdd.map(...)</span> maps the raw into into the <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">PtAgg</span> class we use to represent points</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sc.broadcast(c_centers_old)</span> sends the locations of the cluster centers to all machines holding RDDs</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">pt_rdd.map(...).reduce(...)</span> maps each point to the center it&#8217;s closest to and then reduces to produce the average location of the points that are closest to each center (the result is in the driver script)</li>
<li><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[t.Normalize() if t.cnt != 0 else random_point_location() for t in totals]</span> updates the new cluster locations.</li>
</ul>
<div dir="ltr" style="margin-bottom: 0pt; margin-top: 0pt;">
As it happens, I didn&#8217;t actually need to write that code because Spark has an ML library (mllib) containing many algorithms including k-means.  In practice, k-means is a just a few functions calls, <a href="http://spark.apache.org/docs/latest/mllib-clustering.html">details are here</a>.<br />
<br />
Here is where the difference between Spark and Beam is most apparent&nbsp;&#8212;&nbsp;<b>no iterative algorithm that can stop early, including k-means, can be expressed in Beam</b>. This is because Beam builds the computation graph, then optimizes and ships it to be executed. With iterative algorithms, the complete graph structure cannot be known before hand (don&#8217;t know how many loops will be done), so it can&#8217;t be expressed in Beam. It is possible to express &#8220;loops&#8221; in Dataflow, but only a fixed number of loops can be added.</div>
<div dir="ltr" style="margin-bottom: 0pt; margin-top: 0pt;">
<br /></div>
<h2>
Beam/Dataflow&#8217;s sweet spot: streaming processing</h2>
Streaming processing is an ever-increasingly important topic for data science. After all, who among us really wants to wait for a daily batch pipeline to tell us how our live traffic experiments are doing? For a great introduction to streaming processing, I highly encourage reading Tyler Akidau&#8217;s two blog posts on the topic, <a href="https://www.oreilly.com/ideas/the-world-beyond-batch-streaming-101">The world beyond batch: Streaming 101</a> and <a href="https://www.oreilly.com/ideas/the-world-beyond-batch-streaming-102">102</a>.<br />
<br />
When Dataflow was released, its strongest selling point was streaming (just read the <a href="http://static.googleusercontent.com/media/research.google.com/en//pubs/archive/43864.pdf">paper</a>). That&#8217;s not to say that Spark doesn&#8217;t support streaming process or that it lacks a unified engine for batch and streaming. The significant step Dataflow initially made was (1) a truly unified batch and streaming API and (2) support for event time processing of data, that is, analysis of the results windowed by <b>when they happened not when they reached the analysis machine</b>, (3) and a focus on watermarks (a method for tracking collection progress on unbounded data) and window completeness (has all of the data for this time period been collected). More practically, Dataflow, now Beam, has a streaming API that cleanly separates the important questions of streaming processing: what, where, when, how). It&#8217;s worth noting that different runners currently have different levels of support, e.g., Dataflow supports streaming for Java, but not yet for Python.<br />
<br />
All this is easiest to show using the examples the Dataflow team used in their<a href="https://cloud.google.com/dataflow/blog/dataflow-beam-and-spark-comparison"> recent blog post</a>, which is also a good read. The starkest contrast between the two is shown by their example of calculating hourly team scores for an online game.</div>
<div>
<br />
<h2>
Other differences in framework &#8220;philosophy&#8221;</h2>
There are several design decisions to show that Spark favors fast development by default and requires users to opt-in to performance whereas Dataflow favors high performance by default with the cost of slower development time.</div>
<div>
<h4>
Caching</h4>
Dataflow avoids the need for caching results by &#8220;fusing&#8221; sibling stages that would need the same input. Fusion comes with the limitation that mutable types should not be used. This is because the values are shared among fused sibling and modification would cause invalid results (this is verified against at run-time). This means writing correct Beam code with mutable types requires significantly more care. Spark re-computes by default, which can be much slower but doesn&#8217;t come with correctness issues. Spark does allow for many different caching methods, <a href="http://spark.apache.org/docs/latest/programming-guide.html#which-storage-level-to-choose">should caching be desired</a>.<br />
<h4>
Equality</h4>
Dataflow uses a fast, language agnostic, serialized byte-level equality for comparing classes in GroupByKey and other steps. This becomes a huge issue if the program uses grouping operations on classes that contain hashmaps, sets, or anything that causes semantic equality to differ from byte equality. Spark deserializes classes and uses the class&#8217;s comparison operator for grouping by default and allows user to opt-into byte-level equality making the opposite tradeoff.<br />
<h4>
Overall performance</h4>
Unfortunately, we currently can&#8217;t make any definitive statements about which framework has better overall performance. The <a href="http://mammothdata.com/wp-content/uploads/2016/04/GoogleCloudDataflow.Benchmark.pdf">only study</a> that compared Beam on the Dataflow Service to Spark used an older version of Spark (1.3). Given the significant performance increases with Spark 2.0, it&#8217;s unclear which framework has better performance at present.</div>
<br />
<h2>
Conclusion</h2>
<div>
Spark and Dataflow both solve the limitations of MapReduce with different viewpoints. Which tool is most appropriate will depend on the project. If the focus is interactivity, data exploration or algorithm development, Spark is probably the better option. If the focus is complex streaming processing (especially event time) then Beam would seem a better fit. For running scalable production pipelines, Beam on Cloud Dataflow is likely the better choice.</div>
<div>
<br /></div>
</div>
<div class='post-bottom'>
<div class='post-footer float-container'>
<div class='post-footer-line post-footer-line-1'>
</div>
</div>
<div class='post-share-buttons post-share-buttons-bottom invisible'>
<div class='byline post-share-buttons goog-inline-block'>
<div aria-owns='sharing-popup-Blog1-byline-5882522097717497514' class='sharing' data-title='Next generation tools for data science'>
<button aria-controls='sharing-popup-Blog1-byline-5882522097717497514' aria-label='Share' class='sharing-button touch-icon-button' id='sharing-button-Blog1-byline-5882522097717497514' role='button'>
<div class='flat-icon-button ripple'>
<svg class='svg-icon-24'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_share_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
</div>
</button>
<div class='share-buttons-container'>
<ul aria-hidden='true' aria-label='Share' class='share-buttons hidden' id='sharing-popup-Blog1-byline-5882522097717497514' role='menu'>
<li>
<span aria-label='Get link' class='sharing-platform-button sharing-element-link' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Get link'>
<svg class='svg-icon-24 touch-icon sharing-link'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_link_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Get link</span>
</span>
</li>
<li>
<span aria-label='Share to Facebook' class='sharing-platform-button sharing-element-facebook' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=facebook' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Share to Facebook'>
<svg class='svg-icon-24 touch-icon sharing-facebook'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_facebook_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Facebook</span>
</span>
</li>
<li>
<span aria-label='Share to Twitter' class='sharing-platform-button sharing-element-twitter' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=twitter' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Share to Twitter'>
<svg class='svg-icon-24 touch-icon sharing-twitter'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_twitter_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Twitter</span>
</span>
</li>
<li>
<span aria-label='Share to Pinterest' class='sharing-platform-button sharing-element-pinterest' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=pinterest' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Share to Pinterest'>
<svg class='svg-icon-24 touch-icon sharing-pinterest'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_pinterest_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Pinterest</span>
</span>
</li>
<li>
<span aria-label='Email' class='sharing-platform-button sharing-element-email' data-href='https://www.blogger.com/share-post.g?blogID=5825758052688213474&postID=5882522097717497514&target=email' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Email'>
<svg class='svg-icon-24 touch-icon sharing-email'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_24_email_dark' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Email</span>
</span>
</li>
<li aria-hidden='true' class='hidden'>
<span aria-label='Share to other apps' class='sharing-platform-button sharing-element-other' data-url='http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html' role='menuitem' tabindex='-1' title='Share to other apps'>
<svg class='svg-icon-24 touch-icon sharing-sharingOther'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_more_horiz_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<span class='platform-sharing-text'>Other Apps</span>
</span>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<section class='comments' data-num-comments='4' id='comments'>
<a name='comments'></a>
</section>
</article>
</div>
</div>
</div>
</main>
</div>
<footer class='footer section' id='footer' name='Footer'><div class='widget Attribution' data-version='2' id='Attribution1'>
<div class='widget-content'>
<div class='blogger'>
<a href='https://www.blogger.com' rel='nofollow'>
<svg class='svg-icon-24'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_post_blogger_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
Powered by Blogger
</a>
</div>
</div>
</div></footer>
</div>
</div>
</div>
<aside class='sidebar-container container sidebar-invisible' role='complementary'>
<div class='navigation'>
<button class='svg-icon-24-button flat-icon-button ripple sidebar-back'>
<svg class='svg-icon-24'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_arrow_back_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
</button>
</div>
<div class='sidebar_top_wrapper no-items'>
<div class='sidebar_top no-items section' id='sidebar_top' name='Sidebar (Top)'>
</div>
</div>
<div class='sidebar_bottom section' id='sidebar_bottom' name='Sidebar (Bottom)'><div class='widget BlogArchive' data-version='2' id='BlogArchive1'>
<details class='collapsible extendable'>
<summary>
<div class='collapsible-title'>
<h3 class='title'>
Archive
</h3>
<svg class='svg-icon-24 chevron-down'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_expand_more_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
<svg class='svg-icon-24 chevron-up'>
<use xlink:href='/responsive/sprite_v1_6.css.svg#ic_expand_less_black_24dp' xmlns:xlink='http://www.w3.org/1999/xlink'></use>
</svg>
</div>
</summary>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<div class='first-items'>
<ul class='flat'>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2019/04/'>April 2019<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2018/07/'>July 2018<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2018/03/'>March 2018<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2018/01/'>January 2018<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2017/10/'>October 2017<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2017/07/'>July 2017<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2017/04/'>April 2017<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2017/03/'>March 2017<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2017/01/'>January 2017<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/10/'>October 2016<span class='post-count'>1</span></a>
</li>
</ul>
</div>
<div class='remaining-items'>
<ul class='flat'>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/09/'>September 2016<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/08/'>August 2016<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/07/'>July 2016<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/06/'>June 2016<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/05/'>May 2016<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/03/'>March 2016<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/02/'>February 2016<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2016/01/'>January 2016<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2015/12/'>December 2015<span class='post-count'>1</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2015/11/'>November 2015<span class='post-count'>2</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2015/10/'>October 2015<span class='post-count'>2</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2015/09/'>September 2015<span class='post-count'>2</span></a>
</li>
<li class='archivedate'>
<a href='http://www.unofficialgoogledatascience.com/2015/08/'>August 2015<span class='post-count'>2</span></a>
</li>
</ul>
</div>
<span class='show-more pill-button'>Show more</span>
<span class='show-less hidden pill-button'>Show less</span>
</div>
</div>
</div>
</details>
</div>
</div>
</aside>
<script type="text/javascript" src="https://resources.blogblog.com/blogblog/data/res/1608028642-indie_compiled.js" async="true"></script>
<script type='text/javascript'>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-66929694-1', 'auto', 'blogger');
        ga('blogger.send', 'pageview');
      </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/640298382-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY4Ug1wMArIGDilY4CBgsiMYjAVRug:1556312287365';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d5825758052688213474','//www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html','5825758052688213474');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '5825758052688213474', 'title': 'The Unofficial Google Data Science Blog', 'url': 'http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html', 'canonicalUrl': 'http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html', 'homepageUrl': 'http://www.unofficialgoogledatascience.com/', 'searchUrl': 'http://www.unofficialgoogledatascience.com/search', 'canonicalHomepageUrl': 'http://www.unofficialgoogledatascience.com/', 'blogspotFaviconUrl': 'http://www.unofficialgoogledatascience.com/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': true, 'httpsEnabled': false, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': 'UA-66929694-1', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22The Unofficial Google Data Science Blog - Atom\x22 href\x3d\x22http://www.unofficialgoogledatascience.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22The Unofficial Google Data Science Blog - RSS\x22 href\x3d\x22http://www.unofficialgoogledatascience.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22The Unofficial Google Data Science Blog - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/5825758052688213474/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22The Unofficial Google Data Science Blog - Atom\x22 href\x3d\x22http://www.unofficialgoogledatascience.com/feeds/5882522097717497514/comments/default\x22 /\x3e\n', 'meTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/b1e9f650b2e5f9f3', 'plusOneApiSrc': 'https://apis.google.com/js/plusone.js', 'disableGComments': true, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 300, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '5882522097717497514', 'postImageThumbnailUrl': 'https://lh4.googleusercontent.com/OlvW6SskdqiFWmJeucVj-ESXH7c_GR_0af4Rdo0vDi78eVKVbusCTlbs7UouymD-cfxszDarNsIUexlyuInZ15Wgm6hTGpPVzo7spMvv1mNsf95qlxP5kEKjGMBtPfeyUB-E1qYU\x3ds72-c', 'postImageUrl': 'https://lh4.googleusercontent.com/OlvW6SskdqiFWmJeucVj-ESXH7c_GR_0af4Rdo0vDi78eVKVbusCTlbs7UouymD-cfxszDarNsIUexlyuInZ15Wgm6hTGpPVzo7spMvv1mNsf95qlxP5kEKjGMBtPfeyUB-E1qYU', 'pageName': 'Next generation tools for data science', 'pageTitle': 'The Unofficial Google Data Science Blog: Next generation tools for data science'}}, {'name': 'features', 'data': {'sharing_get_link_dialog': 'true', 'sharing_native': 'false'}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'name': 'custom', 'localizedName': 'Custom', 'isResponsive': true, 'isAlternateRendering': false, 'isCustom': true, 'variant': 'indie_light', 'variantId': 'indie_light'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Next generation tools for data science', 'description': 'By DAVID ADAMS   Since inception, this blog has defined &#8220;data science&#8221;  as inference derived from data too big to fit on a single computer. ...', 'featuredImage': 'https://lh4.googleusercontent.com/OlvW6SskdqiFWmJeucVj-ESXH7c_GR_0af4Rdo0vDi78eVKVbusCTlbs7UouymD-cfxszDarNsIUexlyuInZ15Wgm6hTGpPVzo7spMvv1mNsf95qlxP5kEKjGMBtPfeyUB-E1qYU', 'url': 'http://www.unofficialgoogledatascience.com/2016/08/next-generation-tools-for-data-science.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 5882522097717497514}}, {'name': 'widgets', 'data': [{'title': 'Search This Blog', 'type': 'BlogSearch', 'sectionId': 'search_top', 'id': 'BlogSearch1'}, {'title': 'The Unofficial Google Data Science Blog (Header)', 'type': 'Header', 'sectionId': 'header', 'id': 'Header1'}, {'title': '', 'type': 'PageList', 'sectionId': 'page_list_top', 'id': 'PageList1'}, {'title': 'Blog Posts', 'type': 'Blog', 'sectionId': 'page_body', 'id': 'Blog1', 'posts': [{'id': '5882522097717497514', 'title': 'Next generation tools for data science', 'featuredImage': 'https://lh4.googleusercontent.com/OlvW6SskdqiFWmJeucVj-ESXH7c_GR_0af4Rdo0vDi78eVKVbusCTlbs7UouymD-cfxszDarNsIUexlyuInZ15Wgm6hTGpPVzo7spMvv1mNsf95qlxP5kEKjGMBtPfeyUB-E1qYU', 'showInlineAds': false}], 'headerByline': {'regionName': 'header1', 'items': [{'name': 'share', 'label': ''}, {'name': 'timestamp', 'label': ''}]}, 'footerBylines': [{'regionName': 'footer1', 'items': [{'name': 'comments', 'label': 'comments'}]}], 'allBylineItems': [{'name': 'share', 'label': ''}, {'name': 'timestamp', 'label': ''}, {'name': 'comments', 'label': 'comments'}]}, {'type': 'Attribution', 'sectionId': 'footer', 'id': 'Attribution1'}, {'title': '', 'type': 'BlogArchive', 'sectionId': 'sidebar_bottom', 'id': 'BlogArchive1'}]}]);
_WidgetManager._RegisterWidget('_BlogSearchView', new _WidgetInfo('BlogSearch1', 'search_top', document.getElementById('BlogSearch1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'page_list_top', document.getElementById('PageList1'), {'title': '', 'links': [{'isCurrentPage': false, 'href': 'http://www.unofficialgoogledatascience.com/', 'title': 'Home'}, {'isCurrentPage': false, 'href': 'http://www.unofficialgoogledatascience.com/p/about.html', 'id': '8495885157735034905', 'title': 'About this blog'}], 'mobile': false}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'page_body', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/1977841774-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/368954415-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer', document.getElementById('Attribution1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar_bottom', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
</script>
</body>
</html>